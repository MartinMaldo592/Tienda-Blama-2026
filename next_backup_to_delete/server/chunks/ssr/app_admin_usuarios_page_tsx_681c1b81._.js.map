{"version":3,"sources":["../../../../app/admin/usuarios/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useCallback, useEffect, useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { supabase } from \"@/lib/supabaseClient\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { useRoleGuard } from \"@/lib/use-role-guard\"\r\nimport { AccessDenied } from \"@/components/admin/access-denied\"\r\nimport { createWorkerViaApi, fetchAdminProfiles } from \"@/features/admin\"\r\n\r\nexport default function UsuariosPage() {\r\n  const router = useRouter()\r\n\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  const guard = useRoleGuard({ allowedRoles: [\"admin\"] })\r\n\r\n  const [profiles, setProfiles] = useState<any[]>([])\r\n\r\n  const [email, setEmail] = useState(\"\")\r\n  const [nombre, setNombre] = useState(\"\")\r\n  const [password, setPassword] = useState(\"\")\r\n  const [creating, setCreating] = useState(false)\r\n\r\n  const fetchProfiles = useCallback(async () => {\r\n    try {\r\n      const data = await fetchAdminProfiles()\r\n      setProfiles(data || [])\r\n    } catch (err) {\r\n      setProfiles([])\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (guard.loading || guard.accessDenied) return\r\n\r\n    ;(async () => {\r\n      setLoading(true)\r\n      await fetchProfiles()\r\n      setLoading(false)\r\n    })()\r\n  }, [guard.loading, guard.accessDenied, fetchProfiles])\r\n\r\n  async function handleCreateWorker() {\r\n    const { data: { session } } = await supabase.auth.getSession()\r\n    if (!session) {\r\n      router.push(\"/auth/login\")\r\n      return\r\n    }\r\n\r\n    setCreating(true)\r\n    try {\r\n      const json = await createWorkerViaApi({\r\n        accessToken: session.access_token,\r\n        email,\r\n        nombre,\r\n        password: password || null,\r\n      })\r\n\r\n      if (json?.generatedPassword) {\r\n        alert(`Worker creado. Contraseña generada: ${json.generatedPassword}`)\r\n      } else {\r\n        alert(\"Worker creado\")\r\n      }\r\n\r\n      setEmail(\"\")\r\n      setNombre(\"\")\r\n      setPassword(\"\")\r\n      await fetchProfiles()\r\n    } catch (e: any) {\r\n      alert(e?.message || \"Error\")\r\n    } finally {\r\n      setCreating(false)\r\n    }\r\n  }\r\n\r\n  if (guard.loading || loading) {\r\n    return <div className=\"p-10\">Cargando...</div>\r\n  }\r\n\r\n  if (guard.accessDenied) {\r\n    return <AccessDenied message=\"Solo administradores pueden gestionar usuarios.\" />\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Usuarios</h1>\r\n          <p className=\"text-muted-foreground\">Crea trabajadores y revisa perfiles.</p>\r\n        </div>\r\n        <Button variant=\"outline\" onClick={fetchProfiles}>Actualizar</Button>\r\n      </div>\r\n\r\n      <div className=\"bg-card border border-border rounded-xl p-6 space-y-4\">\r\n        <h2 className=\"text-lg font-semibold\">Crear worker</h2>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"email\">Email</Label>\r\n            <Input id=\"email\" value={email} onChange={(e) => setEmail(e.target.value)} placeholder=\"worker@tienda.com\" />\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"nombre\">Nombre</Label>\r\n            <Input id=\"nombre\" value={nombre} onChange={(e) => setNombre(e.target.value)} placeholder=\"Nombre del trabajador\" />\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"password\">Contraseña (opcional)</Label>\r\n            <Input id=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} placeholder=\"Si lo dejas vacío se genera\" />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-end\">\r\n          <Button onClick={handleCreateWorker} disabled={creating || !email.trim()}>\r\n            {creating ? \"Creando...\" : \"Crear\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-card border border-border rounded-xl overflow-hidden\">\r\n        <div className=\"px-6 py-4 border-b border-border\">\r\n          <h2 className=\"text-lg font-semibold\">Perfiles</h2>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full text-sm\">\r\n            <thead className=\"bg-popover\">\r\n              <tr>\r\n                <th className=\"text-left p-3\">Email</th>\r\n                <th className=\"text-left p-3\">Nombre</th>\r\n                <th className=\"text-left p-3\">Rol</th>\r\n                <th className=\"text-left p-3\">Creado</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {profiles.map((p) => (\r\n                <tr key={p.id} className=\"border-t border-border\">\r\n                  <td className=\"p-3\">{p.email || \"\"}</td>\r\n                  <td className=\"p-3\">{p.nombre || \"\"}</td>\r\n                  <td className=\"p-3\">{p.role || \"\"}</td>\r\n                  <td className=\"p-3\">{p.created_at ? new Date(p.created_at).toLocaleString() : \"\"}</td>\r\n                </tr>\r\n              ))}\r\n              {profiles.length === 0 && (\r\n                <tr>\r\n                  <td className=\"p-6 text-muted-foreground\" colSpan={4}>No hay perfiles.</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}