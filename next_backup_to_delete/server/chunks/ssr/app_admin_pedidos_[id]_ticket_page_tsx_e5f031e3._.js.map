{"version":3,"sources":["../../../../app/admin/pedidos/%5Bid%5D/ticket/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\"\r\nimport { useParams, useRouter } from \"next/navigation\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { formatCurrency } from \"@/lib/utils\"\r\nimport { fetchPedidoDetail } from \"@/features/admin\"\r\n\r\nexport default function PedidoTicketPage() {\r\n  const params = useParams()\r\n  const router = useRouter()\r\n  const id = params.id as string\r\n\r\n  const [pedido, setPedido] = useState<any>(null)\r\n  const [items, setItems] = useState<any[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  useEffect(() => {\r\n    if (!id) return\r\n    fetchTicket()\r\n  }, [id])\r\n\r\n  useEffect(() => {\r\n    if (!pedido) return\r\n    try {\r\n      const orderId = String(pedido.id).padStart(6, \"0\")\r\n      document.title = `Ticket Pedido #${orderId} - Blama Shop`\r\n    } catch (err) {\r\n    }\r\n  }, [pedido])\r\n\r\n  async function fetchTicket() {\r\n    setLoading(true)\r\n\r\n    try {\r\n      const pedidoId = Number(id)\r\n      if (!pedidoId) {\r\n        setPedido(null)\r\n        setItems([])\r\n        setLoading(false)\r\n        return\r\n      }\r\n\r\n      const detail = await fetchPedidoDetail(pedidoId)\r\n      setPedido(detail.pedido)\r\n      setItems(detail.items)\r\n    } catch (error) {\r\n      setPedido(null)\r\n      setItems([])\r\n    }\r\n    setLoading(false)\r\n  }\r\n\r\n  if (loading) {\r\n    return <div className=\"p-10 text-center\">Cargando ticket...</div>\r\n  }\r\n\r\n  if (!pedido) {\r\n    return <div className=\"p-10 text-center\">Pedido no encontrado</div>\r\n  }\r\n\r\n  const subtotal = Number(pedido.subtotal ?? pedido.total)\r\n  const descuento = Number(pedido.descuento ?? 0)\r\n  const total = Number(pedido.total ?? 0)\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto p-6 print:p-0\">\r\n      <div className=\"flex items-center justify-between gap-2 mb-6 print:hidden\">\r\n        <Button variant=\"outline\" onClick={() => router.back()}>\r\n          Volver\r\n        </Button>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\" onClick={() => window.print()}>\r\n            Descargar ticket\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"border border-border rounded-lg p-6 bg-card text-card-foreground print:border-0 print:rounded-none print:p-0\">\r\n        <div className=\"flex items-start justify-between gap-4\">\r\n          <div>\r\n            <h1 className=\"text-xl font-bold\">Ticket de Pedido</h1>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              #{String(pedido.id).padStart(6, \"0\")} • {new Date(pedido.created_at).toLocaleString()}\r\n            </p>\r\n          </div>\r\n          <div className=\"text-right text-sm\">\r\n            <div className=\"font-medium\">Estado</div>\r\n            <div className=\"text-muted-foreground\">{pedido.status}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n          <div className=\"border border-border rounded-md p-4\">\r\n            <div className=\"font-semibold\">Cliente</div>\r\n            <div className=\"text-sm mt-1\">{pedido.clientes?.nombre || \"\"}</div>\r\n            <div className=\"text-sm text-muted-foreground\">DNI: {pedido.clientes?.dni || \"\"}</div>\r\n            <div className=\"text-sm text-muted-foreground\">{pedido.clientes?.telefono || \"\"}</div>\r\n          </div>\r\n          <div className=\"border border-border rounded-md p-4\">\r\n            <div className=\"font-semibold\">Entrega</div>\r\n            <div className=\"text-sm mt-1\">{pedido.clientes?.direccion || \"\"}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-6\">\r\n          <div className=\"font-semibold mb-2\">Productos</div>\r\n          <div className=\"border border-border rounded-md overflow-hidden\">\r\n            <div className=\"grid grid-cols-12 gap-2 p-3 bg-popover text-sm font-medium\">\r\n              <div className=\"col-span-6\">Producto</div>\r\n              <div className=\"col-span-2 text-right\">Cant.</div>\r\n              <div className=\"col-span-2 text-right\">Unit.</div>\r\n              <div className=\"col-span-2 text-right\">Importe</div>\r\n            </div>\r\n            {items.map((it) => {\r\n              const unit = Number(it.productos?.precio ?? 0)\r\n              const qty = Number(it.cantidad ?? 0)\r\n              const line = unit * qty\r\n              return (\r\n                <div key={it.id} className=\"grid grid-cols-12 gap-2 p-3 border-t border-border text-sm\">\r\n                  <div className=\"col-span-6\">{it.productos?.nombre || \"Producto\"}</div>\r\n                  <div className=\"col-span-2 text-right\">{qty}</div>\r\n                  <div className=\"col-span-2 text-right\">{formatCurrency(unit)}</div>\r\n                  <div className=\"col-span-2 text-right\">{formatCurrency(line)}</div>\r\n                </div>\r\n              )\r\n            })}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-6 border-t border-border pt-4 space-y-2\">\r\n          {pedido.cupon_codigo && (\r\n            <div className=\"flex justify-between text-sm\">\r\n              <span className=\"text-muted-foreground\">Cupón</span>\r\n              <span className=\"font-medium\">{pedido.cupon_codigo}</span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Subtotal</span>\r\n            <span className=\"font-medium\">{formatCurrency(subtotal)}</span>\r\n          </div>\r\n          {descuento > 0 && (\r\n            <div className=\"flex justify-between text-sm\">\r\n              <span className=\"text-muted-foreground\">Descuento</span>\r\n              <span className=\"font-medium\">- {formatCurrency(descuento)}</span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex justify-between text-base font-bold\">\r\n            <span>Total</span>\r\n            <span>{formatCurrency(total)}</span>\r\n          </div>\r\n\r\n          <div className=\"pt-3 text-xs text-muted-foreground\">\r\n            Pago: {pedido.pago_status}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAK,EAAO,EAAE,CAEd,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAc,MACpC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAQ,EAAE,EACtC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAgBvC,eAAe,IACb,GAAW,GAEX,GAAI,CACF,IAAM,EAAW,OAAO,GACxB,GAAI,CAAC,EAAU,CACb,EAAU,MACV,EAAS,EAAE,EACX,GAAW,GACX,MACF,CAEA,IAAM,EAAS,MAAM,CAAA,EAAA,EAAA,iBAAA,AAAiB,EAAC,GACvC,EAAU,EAAO,MAAM,EACvB,EAAS,EAAO,KAAK,CACvB,CAAE,MAAO,EAAO,CACd,EAAU,MACV,EAAS,EAAE,CACb,CACA,GAAW,EACb,CAEA,GApCA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACH,GACL,CADS,EAEX,EAAG,CAAC,EAAG,EAEP,CAAA,EAAA,EAAA,SAAS,AAAT,EAAU,KACR,GAAK,CAAD,CACJ,GAAI,CACF,EAFW,EAEL,EAAU,OAAO,EAAO,EAAE,EAAE,QAAQ,CAAC,EAAG,KAC9C,SAAS,KAAK,CAAG,CAAC,eAAe,EAAE,EAAQ,aAAa,CAAC,AAC3D,CAAE,MAAO,EAAK,CACd,CACF,EAAG,CAAC,EAAO,EAwBP,EACF,MAAO,CADI,AACJ,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4BAAmB,uBAG3C,GAAI,CAAC,EACH,MAAO,AADI,CACJ,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4BAAmB,yBAG3C,IAAM,EAAW,OAAO,EAAO,QAAQ,EAAI,EAAO,KAAK,EACjD,EAAY,OAAO,EAAO,SAAS,EAAI,GACvC,EAAQ,OAAO,EAAO,KAAK,EAAI,GAErC,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sEACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,UAAU,QAAS,IAAM,EAAO,IAAI,YAAI,WAGxD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,UAAU,QAAS,IAAM,OAAO,KAAK,YAAI,0BAM7D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yHACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6BAAoB,qBAClC,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,0CAAgC,IACzC,OAAO,EAAO,EAAE,EAAE,QAAQ,CAAC,EAAG,KAAK,MAAI,IAAI,KAAK,EAAO,UAAU,EAAE,cAAc,SAGvF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,+BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uBAAc,WAC7B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAyB,EAAO,MAAM,SAIzD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gDACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yBAAgB,YAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wBAAgB,EAAO,QAAQ,EAAE,QAAU,KAC1D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0CAAgC,QAAM,EAAO,QAAQ,EAAE,KAAO,MAC7E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yCAAiC,EAAO,QAAQ,EAAE,UAAY,QAE/E,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gDACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yBAAgB,YAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wBAAgB,EAAO,QAAQ,EAAE,WAAa,WAIjE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8BAAqB,cACpC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4DACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uEACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBAAa,aAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,UACvC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,UACvC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,eAExC,EAAM,GAAG,CAAC,AAAC,IACV,IAAM,EAAO,OAAO,EAAG,SAAS,EAAE,QAAU,GACtC,EAAM,OAAO,EAAG,QAAQ,EAAI,GAElC,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAgB,UAAU,uEACzB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBAAc,EAAG,SAAS,EAAE,QAAU,aACrD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAyB,IACxC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAyB,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,KACvD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAyB,CAAA,EAAA,EAAA,cAAA,AAAc,EAN7C,AAM8C,EANvC,OAER,EAAG,EAAE,CAOnB,SAIJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uDACZ,EAAO,YAAY,EAClB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,UACxC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,uBAAe,EAAO,YAAY,MAGtD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,aACxC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,uBAAe,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,QAE/C,EAAY,GACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yCACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,cACxC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,wBAAc,KAAG,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,SAGpD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qDACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,UACN,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAM,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,QAGxB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,+CAAqC,SAC3C,EAAO,WAAW,YAMrC"}