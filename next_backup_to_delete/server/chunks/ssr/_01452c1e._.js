module.exports=[34157,a=>{"use strict";let b=(0,a.i(70106).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["default",()=>b])},14548,a=>{"use strict";let b=(0,a.i(70106).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);a.s(["Save",()=>b],14548)},63519,a=>{"use strict";let b=(0,a.i(70106).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);a.s(["Phone",()=>b],63519)},54161,a=>{"use strict";var b=a.i(87924),c=a.i(11011),d=a.i(187),e=a.i(97895);let f=(0,d.cva)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function g({className:a,variant:d,asChild:g=!1,...h}){let i=g?c.Slot:"span";return(0,b.jsx)(i,{"data-slot":"badge",className:(0,e.cn)(f({variant:d}),a),...h})}a.s(["Badge",()=>g])},46842,a=>{"use strict";let b=(0,a.i(70106).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);a.s(["User",()=>b],46842)},11156,a=>{"use strict";let b=(0,a.i(70106).default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);a.s(["CreditCard",()=>b],11156)},36250,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(8999),f=a.i(46639),g=a.i(40695),h=a.i(54161),i=a.i(87682),j=a.i(210),k=a.i(24987),l=a.i(63519),m=a.i(46842),n=a.i(11156),o=a.i(14548);let p=(0,a.i(70106).default)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var q=a.i(97895);a.i(17209);var r=a.i(39367);function s(){let a=(0,d.useParams)(),s=(0,d.useRouter)(),v=a.id,w=(0,e.useRoleGuard)({allowedRoles:["admin","worker"]}),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!0),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)("unassigned"),[L,M]=(0,c.useState)("worker");function N(a,b){let c=String(a?.code||""),d=String(a?.message||""),e=d.toLowerCase();return"42501"===c||e.includes("permission denied")||e.includes("row level security")||e.includes("violates row-level security")?(alert("No tienes permisos para realizar esta acción."),!0):(alert(b+d),!1)}let O=(0,c.useCallback)(async()=>{E(!0);try{let a=Number(v);if(!a){y(null),A([]),E(!1);return}let b=await (0,r.fetchPedidoDetail)(a);y(b.pedido),I(String(b.pedido?.status||"")),K(String(b.pedido?.asignado_a||"unassigned")),A(b.items)}catch(a){console.error("Error fetching pedido:",a),y(null),A([])}E(!1)},[v]);async function P(a){try{await (0,r.assignPedidoToWorker)({pedidoId:Number(v),workerId:"unassigned"===a?null:a}),K(a),O()}catch(a){N(a,"Error al asignar: ")}}async function Q(){G(!0),console.log("Updating status to:",H);try{await (0,r.updatePedidoStatusWithStock)({pedidoId:Number(v),nextStatus:H,stockDescontado:!!x?.stock_descontado}),alert("Estado actualizado correctamente"),O()}catch(a){console.error("Error updating status:",a),N(a,"Error al actualizar: ")}G(!1)}return((0,c.useEffect)(()=>{if(!v||w.loading||w.accessDenied)return;let a=String(w.role||"worker");M(a),(async()=>{if("admin"===a)try{let a=await (0,r.fetchAdminWorkers)();C(a)}catch(a){C([])}else C([]);await O()})()},[v,w.loading,w.accessDenied,w.role,O]),w.loading)?(0,b.jsx)("div",{className:"p-10",children:"Cargando..."}):w.accessDenied?(0,b.jsx)(f.AccessDenied,{}):D?(0,b.jsx)("div",{className:"p-10 text-center",children:"Cargando pedido..."}):x?(0,b.jsxs)("div",{className:"space-y-6 max-w-5xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>s.back(),children:(0,b.jsx)(j.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-2",children:["Pedido #",x.id.toString().padStart(6,"0"),(0,b.jsx)(t,{status:x.status})]}),(0,b.jsxs)("p",{className:"text-gray-500 text-sm",children:["Realizado el ",new Date(x.created_at).toLocaleString()]})]}),(0,b.jsxs)("div",{className:"ml-auto flex gap-2 items-center",children:[(0,b.jsx)(g.Button,{variant:"outline",size:"sm",onClick:()=>s.push(`/admin/pedidos/${v}/ticket`),children:"Descargar ticket"}),(0,b.jsxs)("div",{className:"flex gap-2 items-center bg-white p-2 rounded-lg border shadow-sm",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Estado:"}),(0,b.jsxs)(i.Select,{value:H,onValueChange:I,children:[(0,b.jsx)(i.SelectTrigger,{className:"w-[180px]",children:(0,b.jsx)(i.SelectValue,{})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"Pendiente",children:"Pendiente"}),(0,b.jsx)(i.SelectItem,{value:"Confirmado",children:"Confirmado"}),(0,b.jsx)(i.SelectItem,{value:"Preparando",children:"Preparando"}),(0,b.jsx)(i.SelectItem,{value:"Enviado",children:"Enviado"}),(0,b.jsx)(i.SelectItem,{value:"Entregado",children:"Entregado"}),(0,b.jsx)(i.SelectItem,{value:"Fallido",children:"Fallido / Cancelado"})]})]}),(0,b.jsxs)(g.Button,{size:"sm",onClick:Q,disabled:F||H===x.status,children:[(0,b.jsx)(o.Save,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"md:col-span-2 space-y-6",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[(0,b.jsxs)("h2",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[(0,b.jsx)(u,{className:"h-5 w-5"})," Productos"]}),(0,b.jsx)("div",{className:"space-y-4",children:z.map(a=>(0,b.jsxs)("div",{className:"flex gap-4 items-center border-b pb-4 last:border-0 last:pb-0",children:[(0,b.jsx)("div",{className:"h-16 w-16 bg-gray-100 rounded-md overflow-hidden flex-shrink-0",children:a.productos?.imagen_url?(0,b.jsx)("img",{src:a.productos.imagen_url,className:"h-full w-full object-cover"}):(0,b.jsx)("div",{className:"h-full w-full flex items-center justify-center text-gray-400 text-xs",children:"Sin img"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.productos?.nombre||"Producto eliminado"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Cantidad: ",a.cantidad]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-medium",children:(0,q.formatCurrency)((a.productos?.precio||0)*(a.cantidad||0))}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,q.formatCurrency)(a.productos?.precio||0)," c/u"]})]})]},a.id))}),(0,b.jsxs)("div",{className:"mt-6 pt-4 border-t flex justify-between items-center text-lg font-bold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsx)("span",{children:(0,q.formatCurrency)(x.total)})]})]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,b.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,b.jsx)(m.User,{className:"h-5 w-5"})," Cliente"]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Nombre"}),(0,b.jsx)("p",{className:"font-medium",children:x.clientes?.nombre})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"DNI"}),(0,b.jsx)("p",{className:"font-medium",children:x.clientes?.dni||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Teléfono"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Phone,{className:"h-4 w-4 text-gray-400"}),(0,b.jsx)("a",{href:`tel:${x.clientes?.telefono}`,className:"font-medium text-blue-600 hover:underline",children:x.clientes?.telefono})]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,b.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,b.jsx)(k.MapPin,{className:"h-5 w-5"})," Envío"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Dirección"}),(0,b.jsx)("p",{className:"font-medium text-sm mt-1",children:x.clientes?.direccion})]}),(0,b.jsx)(g.Button,{variant:"outline",className:"w-full text-xs",onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(x.clientes?.direccion)}`,"_blank"),children:"Ver en Google Maps"})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,b.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,b.jsx)(n.CreditCard,{className:"h-5 w-5"})," Pago"]}),(0,b.jsx)(h.Badge,{variant:"secondary",className:"text-sm py-1 px-3 w-full justify-center",children:x.pago_status})]}),"admin"===L&&(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,b.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,b.jsx)(p,{className:"h-5 w-5"})," Asignación"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Trabajador asignado"}),(0,b.jsxs)(i.Select,{value:J,onValueChange:P,children:[(0,b.jsx)(i.SelectTrigger,{children:(0,b.jsx)(i.SelectValue,{children:x.asignado_perfil?.nombre||x.asignado_perfil?.email||(0,b.jsx)("span",{className:"text-orange-600",children:"Sin asignar"})})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"unassigned",children:(0,b.jsx)("span",{className:"text-gray-500",children:"Sin asignar"})}),B.map(a=>(0,b.jsx)(i.SelectItem,{value:a.id,children:a.nombre||a.email},a.id))]})]})]}),x.fecha_asignacion&&(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:["Asignado el ",new Date(x.fecha_asignacion).toLocaleString()]})]}),"worker"===L&&x.asignado_perfil&&(0,b.jsxs)("div",{className:"bg-blue-50 rounded-xl border border-blue-200 p-4",children:[(0,b.jsx)("p",{className:"text-xs text-blue-600 font-medium",children:"Este pedido te fue asignado"}),x.fecha_asignacion&&(0,b.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:new Date(x.fecha_asignacion).toLocaleString()})]})]})]})]}):(0,b.jsx)("div",{className:"p-10 text-center",children:"Pedido no encontrado"})}function t({status:a}){return(0,b.jsx)("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium border ${{Pendiente:"bg-yellow-100 text-yellow-800 border-yellow-200",Confirmado:"bg-blue-100 text-blue-800 border-blue-200",Entregado:"bg-green-100 text-green-800 border-green-200",Cancelado:"bg-red-100 text-red-800 border-red-200"}[a]||"bg-gray-100"}`,children:a})}function u({className:a}){return(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:a,children:[(0,b.jsx)("path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"}),(0,b.jsx)("path",{d:"M3 6h18"}),(0,b.jsx)("path",{d:"M16 10a4 4 0 0 1-8 0"})]})}a.s(["default",()=>s],36250)}];

//# sourceMappingURL=_01452c1e._.js.map