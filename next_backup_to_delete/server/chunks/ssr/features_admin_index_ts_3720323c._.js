module.exports=[17209,44538,39367,17071,98748,17680,35714,13001,33819,11511,88025,41888,a=>{"use strict";var b=a.i(7291);async function c(a){let c=String(a.role||"worker"),d=String(a.currentUserId||""),{data:e}=await b.supabase.from("pedidos").select("id, total, status, asignado_a, created_at"),f=(e||[]).filter(a=>"Entregado"===a.status),g=f.reduce((a,b)=>a+(Number(b.total)||0),0),h=new Date,i=h.getFullYear(),j=String(h.getMonth()+1).padStart(2,"0"),k=String(h.getDate()).padStart(2,"0"),l=`${i}-${j}-${k}`,m=f.filter(a=>"string"==typeof a.created_at&&a.created_at.startsWith(l)).reduce((a,b)=>a+(Number(b.total)||0),0),n=(e||[]).filter(a=>"Pendiente"===a.status).length,o=(e||[]).filter(a=>["Confirmado","Preparando","Enviado"].includes(a.status)).length,p=f.length,q=(e||[]).filter(a=>a.asignado_a===d&&!["Fallido","Devuelto","Entregado"].includes(a.status)).length,r=0;if("admin"===c){let{count:a}=await b.supabase.from("clientes").select("*",{count:"exact",head:!0});r=a||0}let s=0;if("admin"===c){let{count:a}=await b.supabase.from("productos").select("*",{count:"exact",head:!0}).lt("stock",5);s=a||0}return{totalVentasReales:g,ventasHoy:m,pedidosPendientes:n,pedidosEnProceso:o,pedidosEntregados:p,pedidosAsignados:q,totalClientes:r,productosLowStock:s}}async function d(a){let c=a.from?`${a.from}T00:00:00.000Z`:void 0,d=a.to?`${a.to}T23:59:59.999Z`:void 0,e=b.supabase.from("pedidos").select("id, total, status, created_at, clientes (nombre, telefono, dni)").eq("status","Entregado").order("created_at",{ascending:!1});c&&(e=e.gte("created_at",c)),d&&(e=e.lte("created_at",d));let{data:f,error:g}=await e;if(g)throw g;return f||[]}async function e(a){let c=Number(a.threshold),{data:d,error:e}=await b.supabase.from("productos").select("id, nombre, precio, stock, imagen_url").lt("stock",c).order("stock",{ascending:!0});if(e)throw e;return d||[]}async function f(){let{data:a,error:c}=await b.supabase.from("pedidos").select("id, total, status, created_at, clientes (nombre, telefono, dni)").eq("status","Pendiente").order("created_at",{ascending:!1});if(c)throw c;return a||[]}let g=["Confirmado","Preparando","Enviado"];async function h(a){let c=a.from?`${a.from}T00:00:00.000Z`:void 0,d=a.to?`${a.to}T23:59:59.999Z`:void 0,e=b.supabase.from("pedidos").select("id, total, status, created_at, asignado_a, clientes (nombre, telefono, dni)").in("status",g).order("created_at",{ascending:!1});"all"!==a.status&&(e=e.eq("status",a.status)),c&&(e=e.gte("created_at",c)),d&&(e=e.lte("created_at",d));let{data:f,error:h}=await e;if(h)throw h;return f||[]}async function i(){let{data:a,error:c}=await b.supabase.from("profiles").select("id, email, nombre, role").eq("role","worker");if(c)throw c;return a||[]}async function j(a){let c=String(a.role||"worker"),d=String(a.currentUserId||""),e=b.supabase.from("pedidos").select(`
        *,
        clientes (nombre, telefono, dni)
      `).order("created_at",{ascending:!1});"worker"===c&&(e=e.eq("asignado_a",d));let{data:f,error:g}=await e;if(g){if(String(g.message||"").includes("asignado_a")){let{data:a}=await b.supabase.from("pedidos").select("*, clientes (nombre, telefono, dni)").order("created_at",{ascending:!1});return a||[]}throw g}return await Promise.all((f||[]).map(async a=>{if(a.asignado_a){let{data:c}=await b.supabase.from("profiles").select("id, email, nombre").eq("id",a.asignado_a).single();return{...a,asignado_perfil:c||null}}return{...a,asignado_perfil:null}}))}async function k(a){let c=a.workerId?String(a.workerId):null,{error:d}=await b.supabase.from("pedidos").update({asignado_a:c,fecha_asignacion:c?new Date().toISOString():null}).eq("id",a.pedidoId);if(d)throw d}async function l(a){let{data:c,error:d}=await b.supabase.from("pedidos").select(`
        *,
        clientes (*)
      `).eq("id",a).single();if(d)throw d;let e=null;if(c?.asignado_a){let{data:a}=await b.supabase.from("profiles").select("id, email, nombre").eq("id",c.asignado_a).single();e=a}let f={...c,asignado_perfil:e},{data:g,error:h}=await b.supabase.from("pedido_items").select(`
        *,
        productos (nombre, precio, imagen_url)
      `).eq("pedido_id",a);if(h)throw h;return{pedido:f,items:g||[]}}async function m(a){let c=Number(a.pedidoId),d=String(a.nextStatus||"");if("Confirmado"===d&&!a.stockDescontado){let{data:a,error:d}=await b.supabase.from("pedido_items").select("producto_id, producto_variante_id, cantidad").eq("pedido_id",c);if(d)throw d;for(let c of(a||[]).filter(a=>a.producto_id)){let a=Number(c.producto_id),d=null!=c.producto_variante_id?Number(c.producto_variante_id):null,e=Number(c.cantidad||0);if(a&&!(e<=0))if(d){let{data:a,error:c}=await b.supabase.from("producto_variantes").select("stock").eq("id",d).single();if(c)throw c;let f=Math.max(0,Number(a?.stock??0)-e),{error:g}=await b.supabase.from("producto_variantes").update({stock:f}).eq("id",d);if(g)throw g}else{let{data:c,error:d}=await b.supabase.from("productos").select("stock").eq("id",a).single();if(d)throw d;let f=Math.max(0,Number(c?.stock??0)-e),{error:g}=await b.supabase.from("productos").update({stock:f}).eq("id",a);if(g)throw g}}let{error:e}=await b.supabase.from("pedidos").update({stock_descontado:!0}).eq("id",c);if(e)throw e}let{error:e}=await b.supabase.from("pedidos").update({status:d}).eq("id",c);if(e)throw e}async function n(){let{data:a,error:c}=await b.supabase.from("productos").select("*").order("id",{ascending:!0});if(c)throw c;return a||[]}async function o(a){let{data:c,error:d}=await b.supabase.from("productos").select("*").eq("id",a).single();if(d)throw d;return c}async function p(){let{data:a,error:c}=await b.supabase.from("categorias").select("*");if(c)throw c;return a||[]}async function q(a){let c=String(a.nombre||"").trim(),d=c.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),{data:e,error:f}=await b.supabase.from("categorias").insert({nombre:c,slug:d}).select().single();if(f)throw f;return e}async function r(a){let[c,d]=await Promise.all([b.supabase.from("producto_especificaciones").select("*").eq("producto_id",a).order("orden",{ascending:!0}).order("id",{ascending:!0}),b.supabase.from("producto_variantes").select("*").eq("producto_id",a).order("id",{ascending:!0})]);return{specs:c.data||[],variants:d.data||[]}}async function s(a){let c=Array.isArray(a.files)?a.files:[],d=[];for(let a of c){let c=a.name.split(".").pop()||"jpg",e=`${Date.now()}-${Math.random().toString(16).slice(2)}.${c}`,f=`imagenes/${e}`,{error:g}=await b.supabase.storage.from("productos").upload(f,a);if(g)throw g;let{data:h}=b.supabase.storage.from("productos").getPublicUrl(f);h?.publicUrl&&d.push(h.publicUrl)}return d}async function t(a){let c=Array.isArray(a.files)?a.files:[],d=[];for(let a of c){let c=a.name.split(".").pop()||"mp4",e=`${Date.now()}-${Math.random().toString(16).slice(2)}.${c}`,f=`videos/${e}`,{error:g}=await b.supabase.storage.from("productos").upload(f,a,{upsert:!1,contentType:a.type||"video/mp4"});if(g)throw g;let{data:h}=b.supabase.storage.from("productos").getPublicUrl(f);h?.publicUrl&&d.push(h.publicUrl)}return d}async function u(a){let b=await fetch("/api/admin/productos",{method:a.method,headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.accessToken}`},body:JSON.stringify(a.body)}),c=null;try{c=await b.json()}catch(a){c=null}if(!b.ok||!c?.ok)throw Error(String(c?.error||"No se pudo guardar el producto"));return c}async function v(a){let b=await fetch("/api/admin/productos",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.accessToken}`},body:JSON.stringify({id:a.id})}),c=null;try{c=await b.json()}catch(a){c=null}if(!b.ok||!c?.ok)throw Error(String(c?.error||"No se pudo eliminar"));return c}async function w(){let{data:a,error:c}=await b.supabase.from("profiles").select("id, email, nombre, role, created_at").order("created_at",{ascending:!1});if(c)throw c;return a||[]}async function x(a){let b=await fetch("/api/admin/create-worker",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.accessToken}`},body:JSON.stringify({email:a.email,nombre:a.nombre,password:a.password})}),c=await b.json();if(!b.ok)throw Error(String(c?.error||"Error"));return c}async function y(){let{data:a,error:c}=await b.supabase.from("cupones").select("*").order("created_at",{ascending:!1});if(c)throw c;return a||[]}async function z(a){let{error:c}=await b.supabase.from("cupones").insert(a);if(c)throw c}async function A(a,c){let{error:d}=await b.supabase.from("cupones").update(c).eq("id",a);if(d)throw d}async function B(a){let{error:c}=await b.supabase.from("cupones").delete().eq("id",a);if(c)throw c}async function C(){let{data:a,error:c}=await b.supabase.from("home_banners").select("*").order("orden",{ascending:!0}).order("id",{ascending:!0});if(c)throw c;return a||[]}async function D(a){if(null!=a.id){let{error:c}=await b.supabase.from("home_banners").update(a.payload).eq("id",a.id);if(c)throw c;return}let{error:c}=await b.supabase.from("home_banners").insert(a.payload);if(c)throw c}async function E(a){let{error:c}=await b.supabase.from("home_banners").delete().eq("id",a);if(c)throw c}async function F(){let a=await b.supabase.auth.getSession();return a?.data?.session?.access_token||""}async function G(){let a=await F();if(!a)throw Error("No autorizado");let b=await fetch("/api/admin/announcement-bar",{method:"GET",headers:{Authorization:`Bearer ${a}`}}),c=null;try{c=await b.json()}catch(a){c=null}if(!b.ok||!c?.ok)throw Error(String(c?.error||"No se pudo obtener la configuraciÃ³n"));let d=c?.data||{};return{enabled:!!d.enabled,interval_ms:Number(d.interval_ms)||3500,messages:Array.isArray(d.messages)?d.messages:[]}}async function H(a){let b=await F();if(!b)throw Error("No autorizado");let c=await fetch("/api/admin/announcement-bar",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(a)}),d=null;try{d=await c.json()}catch(a){d=null}if(!c.ok||!d?.ok)throw Error(String(d?.error||"No se pudo guardar"));return d}async function I(){let{data:a,error:c}=await b.supabase.from("pedidos").select("id, status, created_at, clientes (nombre, telefono)").order("created_at",{ascending:!1}).limit(200);if(c)throw c;return a||[]}async function J(){let{data:a,error:c}=await b.supabase.from("incidencias").select("*, pedidos (id, status, created_at, clientes (nombre, telefono))").order("created_at",{ascending:!1});if(c)throw c;return a||[]}async function K(a){let c=String(a.pedidoId||"").trim(),d=Array.isArray(a.files)?a.files:[],e=[];for(let a of d){let d=a.name.split(".").pop()||"jpg",f=`${Date.now()}-${Math.random().toString(16).slice(2)}.${d}`,g=c?`incidencias/${c}`:"incidencias",h=`${g}/${f}`,{error:i}=await b.supabase.storage.from("productos").upload(h,a);if(i)throw i;let{data:j}=b.supabase.storage.from("productos").getPublicUrl(h);j?.publicUrl&&e.push(j.publicUrl)}return e}async function L(a){async function c(c){let d={...a};return c||delete d.fotos,b.supabase.from("incidencias").insert(d)}let d=(await c(!0)).error;if(d&&"string"==typeof d.message&&d.message.toLowerCase().includes("fotos")&&(d=(await c(!1)).error),d)throw Error(d.message)}async function M(a){let{error:c}=await b.supabase.from("incidencias").delete().eq("id",a);if(c)throw c}async function N(){let{data:a,error:c}=await b.supabase.from("product_questions").select("id, product_id, question, asker_name, asker_phone, published, created_at, productos(nombre), product_answers(id, answer, answered_by, created_at, published)").order("created_at",{ascending:!1}).limit(200);if(c)throw c;return a||[]}async function O(a){let{error:c}=await b.supabase.from("product_questions").update({published:a.published}).eq("id",a.id);if(c)throw c}async function P(a){let c=String(a.answer||"").trim(),{data:d}=await b.supabase.auth.getSession(),e=d?.session?.user?.id||null,f=null;if(e){let{data:a}=await b.supabase.from("profiles").select("email, nombre").eq("id",e).maybeSingle();f=String(a?.nombre||a?.email||"Admin")}let{data:g}=await b.supabase.from("product_questions").select("id, product_answers(id)").eq("id",a.questionId).maybeSingle(),h=g&&Array.isArray(g.product_answers)&&g.product_answers.length>0?Number(g.product_answers[0]?.id):null;if(h){let{error:a}=await b.supabase.from("product_answers").update({answer:c,answered_by:f,published:!0}).eq("id",h);if(a)throw a}else{let{error:d}=await b.supabase.from("product_answers").insert({question_id:a.questionId,answer:c,answered_by:f,published:!0});if(d)throw d}let{error:i}=await b.supabase.from("product_questions").update({published:!0}).eq("id",a.questionId);if(i)throw i}async function Q(){let{data:a,error:c}=await b.supabase.from("product_reviews").select("id, product_id, rating, title, body, customer_name, customer_city, verified, approved, created_at, productos(nombre)").order("created_at",{ascending:!1}).limit(200);if(c)throw c;return a||[]}async function R(a){let{error:c}=await b.supabase.from("product_reviews").update({approved:a.approved}).eq("id",a.id);if(c)throw c}async function S(a){let{error:c}=await b.supabase.from("product_reviews").delete().eq("id",a);if(c)throw c}async function T(){let{data:a,error:c}=await b.supabase.from("clientes").select("*").order("id",{ascending:!1});if(c)throw c;return a||[]}a.s(["fetchAdminDashboardStats",()=>c,"fetchAdminPedidosEnProceso",()=>h,"fetchAdminPedidosPendientes",()=>f,"fetchAdminStockBajo",()=>e,"fetchAdminVentasEntregadas",()=>d],44538),a.s(["assignPedidoToWorker",()=>k,"fetchAdminWorkers",()=>i,"fetchPedidoDetail",()=>l,"fetchPedidosForRole",()=>j,"updatePedidoStatusWithStock",()=>m],39367),a.s(["createAdminCategoria",()=>q,"deleteAdminProductoViaApi",()=>v,"fetchAdminCategorias",()=>p,"fetchAdminProductoById",()=>o,"fetchAdminProductos",()=>n,"fetchProductoSpecsAndVariants",()=>r,"saveAdminProductoViaApi",()=>u,"uploadProductImages",()=>s,"uploadProductVideos",()=>t],17071),a.s(["createWorkerViaApi",()=>x,"fetchAdminProfiles",()=>w],98748),a.s(["createAdminCupon",()=>z,"deleteAdminCupon",()=>B,"fetchAdminCupones",()=>y,"updateAdminCupon",()=>A],17680),a.s(["deleteHomeBanner",()=>E,"fetchHomeBanners",()=>C,"saveHomeBanner",()=>D],35714),a.s(["fetchAnnouncementBarConfigViaApi",()=>G,"saveAnnouncementBarConfigViaApi",()=>H],13001),a.s(["createIncidencia",()=>L,"deleteIncidencia",()=>M,"fetchIncidencias",()=>J,"fetchPedidosForIncidencias",()=>I,"uploadIncidenciaImages",()=>K],33819),a.s(["fetchAdminQuestions",()=>N,"saveQuestionAnswer",()=>P,"setQuestionPublished",()=>O],11511),a.s(["deleteReview",()=>S,"fetchAdminReviews",()=>Q,"setReviewApproved",()=>R],88025),a.s(["fetchAdminClientes",()=>T],41888),a.s([],17209)}];

//# sourceMappingURL=features_admin_index_ts_3720323c._.js.map