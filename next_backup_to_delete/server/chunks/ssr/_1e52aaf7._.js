module.exports=[3130,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>g,"CardFooter",()=>h,"CardHeader",()=>e,"CardTitle",()=>f])},34157,a=>{"use strict";let b=(0,a.i(70106).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["default",()=>b])},88237,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,b.jsx)("table",{"data-slot":"table",className:(0,c.cn)("w-full caption-bottom text-sm",a),...d})})}function e({className:a,...d}){return(0,b.jsx)("thead",{"data-slot":"table-header",className:(0,c.cn)("[&_tr]:border-b",a),...d})}function f({className:a,...d}){return(0,b.jsx)("tbody",{"data-slot":"table-body",className:(0,c.cn)("[&_tr:last-child]:border-0",a),...d})}function g({className:a,...d}){return(0,b.jsx)("tr",{"data-slot":"table-row",className:(0,c.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...d})}function h({className:a,...d}){return(0,b.jsx)("th",{"data-slot":"table-head",className:(0,c.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}function i({className:a,...d}){return(0,b.jsx)("td",{"data-slot":"table-cell",className:(0,c.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}a.s(["Table",()=>d,"TableBody",()=>f,"TableCell",()=>i,"TableHead",()=>h,"TableHeader",()=>e,"TableRow",()=>g])},69520,a=>{"use strict";let b=(0,a.i(70106).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>b],69520)},46893,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("textarea",{"data-slot":"textarea",className:(0,c.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...d})}a.s(["Textarea",()=>d])},74618,a=>{"use strict";let b=(0,a.i(70106).default)("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);a.s(["UploadCloud",()=>b],74618)},30532,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(8999),f=a.i(46639),g=a.i(40695),h=a.i(3130),i=a.i(5522),j=a.i(46893),k=a.i(87682),l=a.i(88237);let m=(0,a.i(70106).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var n=a.i(69520),o=a.i(81560),p=a.i(74618),q=a.i(33508);a.i(17209);var r=a.i(33819);let s=["Devolución","Queja","Producto dañado","Entrega tardía","Otro"];function t(){let[a,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),y=(0,e.useRoleGuard)({allowedRoles:["admin","worker"]}),[z,A]=(0,c.useState)("worker"),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)("Queja"),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)("all"),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)([]),R=(0,c.useCallback)(async()=>{try{let a=await (0,r.fetchPedidosForIncidencias)();Q(a)}catch(a){console.error("Error fetching pedidos:",a),Q([])}},[]),S=(0,c.useCallback)(async()=>{try{let a=await (0,r.fetchIncidencias)();O(a)}catch(a){console.error("Error fetching incidencias:",a),O([])}},[]),T=(0,c.useCallback)(async()=>{t(!0),await R(),await S(),t(!1)},[S,R]);(0,c.useEffect)(()=>{y.loading||y.accessDenied||(A(String(y.role||"worker")),T())},[y.loading,y.accessDenied,y.role,T]);let U=(0,c.useMemo)(()=>{let a=J.trim();return N.filter(b=>{let c=!a||String(b.pedido_id||"").includes(a),d="all"===L||String(b.tipo||"")===L;return c&&d})},[N,J,L]);async function V(){let a=String(B||"").trim();if(!a)return void alert("Selecciona un pedido");if(!F.trim())return void alert("Ingresa un comentario");v(!0);try{let c=(H||[]).map(a=>String(a||"").trim()).filter(Boolean).slice(0,5),d=c[0]||null,e={pedido_id:Number(a),tipo:D,comentario:F.trim(),foto:d,fotos:c};async function b(a){let b={...e};return a||delete b.fotos,(0,r.createIncidencia)(b)}await b(!0),C(""),E("Queja"),G(""),I([]),await S()}catch(d){console.error("Error creating incidencia:",d);let a=String(d?.code||""),b=String(d?.message||""),c=b.toLowerCase();"42501"===a||c.includes("permission denied")||c.includes("row level security")||c.includes("violates row-level security")?alert("No tienes permisos para realizar esta acción."):alert("No se pudo crear la incidencia: "+(b||""))}finally{v(!1)}}async function W(a){if("admin"===z&&confirm("¿Eliminar esta incidencia?")){try{await (0,r.deleteIncidencia)(a)}catch(d){let a=String(d?.code||""),b=String(d?.message||""),c=b.toLowerCase();"42501"===a||c.includes("permission denied")||c.includes("row level security")||c.includes("violates row-level security")?alert("No tienes permisos para realizar esta acción."):alert("Error al eliminar: "+b);return}await S()}}return y.loading||a?(0,b.jsx)("div",{className:"p-10",children:"Cargando..."}):y.accessDenied?(0,b.jsx)(f.AccessDenied,{}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Incidencias"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Gestiona reclamos, devoluciones y problemas de pedidos."})]}),(0,b.jsxs)(g.Button,{variant:"outline",className:"gap-2",onClick:T,disabled:a,children:[(0,b.jsx)(n.RefreshCw,{className:"h-4 w-4"})," Actualizar"]})]}),(0,b.jsxs)(h.Card,{className:"shadow-sm border-gray-200",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(m,{className:"h-5 w-5 text-amber-600"})," Registrar incidencia"]})}),(0,b.jsxs)(h.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Pedido"}),(0,b.jsxs)(k.Select,{value:B,onValueChange:C,children:[(0,b.jsx)(k.SelectTrigger,{disabled:u||w,children:(0,b.jsx)(k.SelectValue,{placeholder:"Selecciona un pedido"})}),(0,b.jsx)(k.SelectContent,{children:P.map(a=>(0,b.jsxs)(k.SelectItem,{value:String(a.id),children:["#",String(a.id).padStart(6,"0")," • ",a.status," • ",a.clientes?.nombre||"—"]},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Tipo"}),(0,b.jsxs)(k.Select,{value:D,onValueChange:a=>E(a),children:[(0,b.jsx)(k.SelectTrigger,{disabled:u||w,children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsx)(k.SelectContent,{children:s.map(a=>(0,b.jsx)(k.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Comentario"}),(0,b.jsx)(j.Textarea,{placeholder:"Describe el problema (producto incorrecto, devolución, etc.)",value:F,onChange:a=>G(a.target.value),disabled:u||w})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Fotos (hasta 5)"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("label",{className:`inline-flex items-center gap-2 rounded-md border px-3 py-2 text-sm font-medium ${w?"opacity-60":"cursor-pointer hover:bg-accent"}`,children:[(0,b.jsx)(p.UploadCloud,{className:"h-4 w-4"}),w?"Subiendo...":"Subir imágenes",(0,b.jsx)("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",disabled:u||w||H.length>=5,onChange:async a=>{if(a.target.files&&0!==a.target.files.length)try{x(!0);let b=Array.from(a.target.files),c=Math.max(0,5-H.length),d=b.slice(0,c),e=await (0,r.uploadIncidenciaImages)({pedidoId:B,files:d}),f=[...H,...e].map(a=>String(a||"").trim()).filter(Boolean).slice(0,5);I(f)}catch(a){alert("Error subiendo imagen: "+(a?.message||""))}finally{x(!1),a.target.value=""}}})]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[H.length,"/5"]})]}),H.length>0&&(0,b.jsx)("div",{className:"grid grid-cols-5 gap-2",children:H.map(a=>(0,b.jsxs)("div",{className:"relative aspect-square rounded-md overflow-hidden border bg-popover",children:[(0,b.jsx)("img",{src:a,alt:"Foto incidencia",className:"h-full w-full object-cover"}),(0,b.jsx)("button",{type:"button",className:"absolute top-1 right-1 h-7 w-7 rounded-full bg-background/80 border flex items-center justify-center",onClick:()=>I(b=>b.filter(b=>b!==a)),disabled:u||w,"aria-label":"Quitar",children:(0,b.jsx)(q.X,{className:"h-4 w-4"})})]},a))})]}),(0,b.jsx)("div",{className:"md:col-span-2",children:(0,b.jsx)(g.Button,{onClick:V,disabled:u||w,className:"w-full md:w-auto",children:"Registrar"})})]})]}),(0,b.jsxs)(h.Card,{className:"shadow-sm border-gray-200",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{children:"Listado"})}),(0,b.jsxs)(h.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Filtrar por pedido"}),(0,b.jsx)(i.Input,{inputMode:"numeric",placeholder:"ID pedido",value:J,onChange:a=>K(a.target.value.replace(/\D/g,""))})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Tipo"}),(0,b.jsxs)(k.Select,{value:L,onValueChange:a=>M(a),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{placeholder:"Todos"})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"all",children:"Todos"}),s.map(a=>(0,b.jsx)(k.SelectItem,{value:a,children:a},a))]})]})]})]}),(0,b.jsx)("div",{className:"bg-white rounded-xl border overflow-hidden",children:(0,b.jsxs)(l.Table,{children:[(0,b.jsx)(l.TableHeader,{className:"bg-gray-50",children:(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableHead,{children:"ID"}),(0,b.jsx)(l.TableHead,{children:"Pedido"}),(0,b.jsx)(l.TableHead,{children:"Tipo"}),(0,b.jsx)(l.TableHead,{children:"Cliente"}),(0,b.jsx)(l.TableHead,{children:"Fecha"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,b.jsx)(l.TableBody,{children:a?(0,b.jsx)(l.TableRow,{children:(0,b.jsx)(l.TableCell,{colSpan:6,className:"text-center py-10",children:"Cargando..."})}):0===U.length?(0,b.jsx)(l.TableRow,{children:(0,b.jsx)(l.TableCell,{colSpan:6,className:"text-center py-10",children:"No hay incidencias."})}):U.map(a=>(0,b.jsxs)(l.TableRow,{children:[(0,b.jsxs)(l.TableCell,{className:"font-mono",children:["#",String(a.id).padStart(5,"0")]}),(0,b.jsxs)(l.TableCell,{children:[(0,b.jsxs)(d.default,{href:`/admin/pedidos/${a.pedido_id}`,className:"text-sm font-medium text-primary hover:underline",children:["#",String(a.pedido_id).padStart(6,"0")]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.pedidos?.status||""})]}),(0,b.jsx)(l.TableCell,{className:"text-sm font-medium",children:a.tipo||""}),(0,b.jsx)(l.TableCell,{children:(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("div",{className:"font-medium",children:a.pedidos?.clientes?.nombre||"—"}),(0,b.jsx)("div",{className:"text-muted-foreground",children:a.pedidos?.clientes?.telefono||""})]})}),(0,b.jsx)(l.TableCell,{className:"text-sm text-muted-foreground",children:new Date(a.created_at).toLocaleString()}),(0,b.jsx)(l.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[a.foto&&(0,b.jsx)("a",{href:a.foto,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-primary hover:underline",children:"Foto"}),"admin"===z&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:()=>W(a.id),children:(0,b.jsx)(o.Trash2,{className:"h-4 w-4 text-red-600"})})]})})]},a.id))})]})})]})]})]})}a.s(["default",()=>t],30532)}];

//# sourceMappingURL=_1e52aaf7._.js.map