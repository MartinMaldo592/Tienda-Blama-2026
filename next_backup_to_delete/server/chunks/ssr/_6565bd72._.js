module.exports=[3130,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>g,"CardFooter",()=>h,"CardHeader",()=>e,"CardTitle",()=>f])},34157,a=>{"use strict";let b=(0,a.i(70106).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["default",()=>b])},88237,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,b.jsx)("table",{"data-slot":"table",className:(0,c.cn)("w-full caption-bottom text-sm",a),...d})})}function e({className:a,...d}){return(0,b.jsx)("thead",{"data-slot":"table-header",className:(0,c.cn)("[&_tr]:border-b",a),...d})}function f({className:a,...d}){return(0,b.jsx)("tbody",{"data-slot":"table-body",className:(0,c.cn)("[&_tr:last-child]:border-0",a),...d})}function g({className:a,...d}){return(0,b.jsx)("tr",{"data-slot":"table-row",className:(0,c.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...d})}function h({className:a,...d}){return(0,b.jsx)("th",{"data-slot":"table-head",className:(0,c.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}function i({className:a,...d}){return(0,b.jsx)("td",{"data-slot":"table-cell",className:(0,c.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}a.s(["Table",()=>d,"TableBody",()=>f,"TableCell",()=>i,"TableHead",()=>h,"TableHeader",()=>e,"TableRow",()=>g])},69520,a=>{"use strict";let b=(0,a.i(70106).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>b],69520)},96143,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(8999),e=a.i(46639),f=a.i(40695),g=a.i(3130),h=a.i(5522),i=a.i(17171),j=a.i(88237),k=a.i(53071),l=a.i(87682),m=a.i(69520),n=a.i(15618),o=a.i(81560);let p=(0,a.i(70106).default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);a.i(17209);var q=a.i(17680);function r(a){if(!a)return"";let b=new Date(a);if(Number.isNaN(b.getTime()))return"";let c=b.getFullYear(),d=String(b.getMonth()+1).padStart(2,"0"),e=String(b.getDate()).padStart(2,"0");return`${c}-${d}-${e}`}function s(){let[a,s]=(0,c.useState)(!0),t=(0,d.useRoleGuard)({allowedRoles:["admin"]}),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)("porcentaje"),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)("true"),[K,L]=(0,c.useState)("0"),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(""),S=(0,c.useCallback)(async()=>{try{let a=await (0,q.fetchAdminCupones)();v(a)}catch(a){console.error("Error fetching cupones:",a),v([])}},[]);function T(){B(null),D(""),F("porcentaje"),H(""),J("true"),L("0"),N(""),P(""),R("")}async function U(){let a=C.trim().toUpperCase();if(!a)return void alert("Ingresa un código");let b=Number(G);if(!Number.isFinite(b)||b<=0)return void alert("Ingresa un valor válido");let c=Number(K);if(!Number.isFinite(c)||c<0)return void alert("Ingresa un mínimo total válido");let d=String(M||"").trim()?Number(M):null;if(null!=d&&(!Number.isFinite(d)||d<1))return void alert("Ingresa un máximo de usos válido");let e={codigo:a,tipo:E,valor:b,activo:"true"===I,min_total:c,max_usos:d,starts_at:function(a){let b=String(a||"").trim();if(!b)return null;let c=new Date(`${b}T00:00:00.000`);return Number.isNaN(c.getTime())?null:c.toISOString()}(O),expires_at:function(a){let b=String(a||"").trim();if(!b)return null;let c=new Date(`${b}T23:59:59.999`);return Number.isNaN(c.getTime())?null:c.toISOString()}(Q)};z(!0);try{A?await (0,q.updateAdminCupon)(A.id,e):await (0,q.createAdminCupon)(e),x(!1),T(),await S(),alert("Cupón guardado")}catch(a){console.error("Error saving cupon:",a),alert(a?.message||"No se pudo guardar")}finally{z(!1)}}async function V(a){if(confirm(`Eliminar cup\xf3n ${a.codigo}?`))try{await (0,q.deleteAdminCupon)(a.id),await S()}catch(a){console.error("Error deleting cupon:",a),alert(a?.message||"No se pudo eliminar")}}(0,c.useEffect)(()=>{t.loading||t.accessDenied||(async()=>{s(!0),await S(),s(!1)})()},[t.loading,t.accessDenied,S]);let W=(0,c.useMemo)(()=>({total:u.length,activos:u.filter(a=>a.activo).length}),[u]);return t.loading||a?(0,b.jsx)("div",{className:"p-10",children:"Cargando..."}):t.accessDenied?(0,b.jsx)(e.AccessDenied,{message:"Solo administradores pueden gestionar cupones."}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Cupones"}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Total: ",W.total," | Activos: ",W.activos]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",className:"gap-2",onClick:S,children:[(0,b.jsx)(m.RefreshCw,{className:"h-4 w-4"})," Actualizar"]}),(0,b.jsxs)(k.Sheet,{open:w,onOpenChange:x,children:[(0,b.jsx)(k.SheetTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{className:"gap-2",onClick:function(){T(),x(!0)},children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4"})," Nuevo"]})}),(0,b.jsxs)(k.SheetContent,{side:"right",className:"w-[90%] sm:max-w-[420px]",children:[(0,b.jsx)(k.SheetHeader,{children:(0,b.jsx)(k.SheetTitle,{children:A?`Editar cup\xf3n`:"Nuevo cupón"})}),(0,b.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"codigo",children:"Código"}),(0,b.jsx)(h.Input,{id:"codigo",value:C,onChange:a=>D(a.target.value),placeholder:"PROMO10",disabled:y})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Tipo"}),(0,b.jsxs)(l.Select,{value:E,onValueChange:a=>F(a),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"porcentaje",children:"Porcentaje"}),(0,b.jsx)(l.SelectItem,{value:"monto",children:"Monto fijo"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"valor",children:"Valor"}),(0,b.jsx)(h.Input,{id:"valor",inputMode:"decimal",value:G,onChange:a=>H(a.target.value),placeholder:"porcentaje"===E?"10":"15",disabled:y})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Estado"}),(0,b.jsxs)(l.Select,{value:I,onValueChange:a=>J(a),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"true",children:"Activo"}),(0,b.jsx)(l.SelectItem,{value:"false",children:"Inactivo"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"minTotal",children:"Mínimo total"}),(0,b.jsx)(h.Input,{id:"minTotal",inputMode:"decimal",value:K,onChange:a=>L(a.target.value),disabled:y})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"maxUsos",children:"Máx usos"}),(0,b.jsx)(h.Input,{id:"maxUsos",inputMode:"numeric",value:M,onChange:a=>N(a.target.value),placeholder:"(vacío = ilimitado)",disabled:y})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"startsAt",children:"Inicio"}),(0,b.jsx)(h.Input,{id:"startsAt",type:"date",value:O,onChange:a=>P(a.target.value),disabled:y})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"expiresAt",children:"Expira"}),(0,b.jsx)(h.Input,{id:"expiresAt",type:"date",value:Q,onChange:a=>R(a.target.value),disabled:y})]})]}),(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)(f.Button,{className:"w-full",onClick:U,disabled:y,children:y?"Guardando...":"Guardar"})})]})]})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Listado"})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Código"}),(0,b.jsx)(j.TableHead,{children:"Tipo"}),(0,b.jsx)(j.TableHead,{children:"Valor"}),(0,b.jsx)(j.TableHead,{children:"Estado"}),(0,b.jsx)(j.TableHead,{children:"Usos"}),(0,b.jsx)(j.TableHead,{children:"Máx"}),(0,b.jsx)(j.TableHead,{children:"Min"}),(0,b.jsx)(j.TableHead,{children:"Inicio"}),(0,b.jsx)(j.TableHead,{children:"Expira"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,b.jsxs)(j.TableBody,{children:[u.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.codigo}),(0,b.jsx)(j.TableCell,{children:a.tipo}),(0,b.jsx)(j.TableCell,{children:String(a.valor)}),(0,b.jsx)(j.TableCell,{children:a.activo?"Activo":"Inactivo"}),(0,b.jsx)(j.TableCell,{children:a.usos}),(0,b.jsx)(j.TableCell,{children:null==a.max_usos?"∞":a.max_usos}),(0,b.jsx)(j.TableCell,{children:String(a.min_total??0)}),(0,b.jsx)(j.TableCell,{children:r(a.starts_at)||"-"}),(0,b.jsx)(j.TableCell,{children:r(a.expires_at)||"-"}),(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>{B(a),D(String(a.codigo||"")),F(a.tipo||"porcentaje"),H(String(a.valor??"")),J(a.activo?"true":"false"),L(String(a.min_total??0)),N(null==a.max_usos?"":String(a.max_usos)),P(r(a.starts_at)),R(r(a.expires_at)),x(!0)},children:(0,b.jsx)(p,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"destructive",size:"icon",onClick:()=>V(a),children:(0,b.jsx)(o.Trash2,{className:"h-4 w-4"})})]})})]},a.id)),0===u.length&&(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:10,className:"text-muted-foreground py-8 text-center",children:"No hay cupones."})})]})]})})})]})]})}a.s(["default",()=>s],96143)}];

//# sourceMappingURL=_6565bd72._.js.map