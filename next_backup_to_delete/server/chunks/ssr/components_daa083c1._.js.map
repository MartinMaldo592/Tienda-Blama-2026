{"version":3,"sources":["../../../../components/ui/card.tsx","../../../../components/product-card.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card\"\r\n      className={cn(\r\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-header\"\r\n      className={cn(\r\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-title\"\r\n      className={cn(\"leading-none font-semibold\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-description\"\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-action\"\r\n      className={cn(\r\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-content\"\r\n      className={cn(\"px-6\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-footer\"\r\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport {\r\n  Card,\r\n  CardHeader,\r\n  CardFooter,\r\n  CardTitle,\r\n  CardAction,\r\n  CardDescription,\r\n  CardContent,\r\n}\r\n","\r\n\"use client\"\r\n\r\nimport Link from \"next/link\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardFooter } from \"@/components/ui/card\"\r\nimport { Plus, Image as ImageIcon } from \"lucide-react\"\r\nimport { formatCurrency, slugify } from \"@/lib/utils\"\r\nimport { Database } from \"@/types/database.types\"\r\nimport { useCartStore } from \"@/features/cart\"\r\nimport { useState, useRef } from \"react\"\r\nimport { ProductImageCarousel } from \"@/components/product-image-carousel\"\r\nimport { useCartAnimationStore } from \"@/features/cart/cart-animation\"\r\n\r\ntype Product = Database['public']['Tables']['productos']['Row']\r\n\r\ninterface ProductCardProps {\r\n    product: Product\r\n    imagePriority?: boolean\r\n}\r\n\r\nexport function ProductCard({ product, imagePriority = false }: ProductCardProps) {\r\n    const addItem = useCartStore((state) => state.addItem)\r\n    const startAnimation = useCartAnimationStore((state) => state.startAnimation)\r\n    const imageRef = useRef<HTMLDivElement>(null)\r\n    const [isAdded, setIsAdded] = useState(false)\r\n\r\n    const currentPrice = Number((product as any)?.precio ?? 0)\r\n    const beforePrice = Number((product as any)?.precio_antes ?? 0)\r\n    const hasSale = Number.isFinite(beforePrice) && beforePrice > 0 && Number.isFinite(currentPrice) && currentPrice > 0 && beforePrice > currentPrice\r\n    const discountPercent = hasSale ? Math.round((1 - currentPrice / beforePrice) * 100) : 0\r\n\r\n    const images = (\r\n        (Array.isArray((product as any).imagenes) ? ((product as any).imagenes as string[]) : [])\r\n            .filter(Boolean)\r\n            .filter((u) => {\r\n                const s = String(u || '').toLowerCase()\r\n                return !(s.endsWith('.mp4') || s.endsWith('.webm') || s.endsWith('.mov') || s.endsWith('.m4v'))\r\n            })\r\n            .slice(0, 10)\r\n    )\r\n    const fallbackImages = images.length > 0 ? images : product.imagen_url ? [product.imagen_url] : []\r\n\r\n    const setCartOpen = useCartAnimationStore((state) => state.setCartOpen)\r\n\r\n    const handleAddToCart = (e: React.MouseEvent) => {\r\n        e.preventDefault() // Link wrapper might trigger navigation if we are not careful, but Button handles click.\r\n\r\n        addItem(product)\r\n        setCartOpen(true)\r\n\r\n        if (imageRef.current && fallbackImages.length > 0) {\r\n            const rect = imageRef.current.getBoundingClientRect()\r\n            startAnimation(fallbackImages[0], rect)\r\n        }\r\n\r\n        // Feedback visual simple\r\n        setIsAdded(true)\r\n        setTimeout(() => setIsAdded(false), 1000)\r\n    }\r\n\r\n    const productHref = `/productos/${slugify(product.nombre)}-${product.id}`\r\n\r\n    return (\r\n        <Card className=\"group overflow-hidden border-none shadow-sm hover:shadow-md transition-all duration-300 bg-card flex flex-col rounded-xl\">\r\n            <Link href={productHref} className=\"block\">\r\n                <div className=\"aspect-square bg-popover relative overflow-hidden\" ref={imageRef}>\r\n                    {fallbackImages.length > 0 ? (\r\n                        <ProductImageCarousel\r\n                            images={fallbackImages}\r\n                            alt={product.nombre}\r\n                            className=\"group-hover:scale-105 transition-transform duration-300\"\r\n                            autoPlay\r\n                            intervalMs={2500}\r\n                            priority={imagePriority}\r\n                            sizes=\"(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 20vw\"\r\n                            quality={70}\r\n                        />\r\n                    ) : (\r\n                        <div className=\"absolute inset-0 flex items-center justify-center text-muted-foreground group-hover:scale-110 transition-transform duration-300\">\r\n                            <ImageIcon className=\"h-10 w-10 opacity-50\" />\r\n                        </div>\r\n                    )}\r\n                    {/* Quick Action Overlay */}\r\n                    <div className=\"absolute inset-0 bg-foreground/5 opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n\r\n                    {hasSale && (\r\n                        <div className=\"absolute left-2 top-2 flex items-center gap-2\">\r\n                            <span className=\"inline-flex items-center rounded-full bg-gradient-to-r from-rose-600 to-orange-500 px-2.5 py-1 text-xs font-extrabold text-white shadow-md ring-1 ring-white/30 backdrop-blur\">\r\n                                -{discountPercent}%\r\n                            </span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </Link>\r\n\r\n            <CardContent className=\"p-3 flex-1 flex flex-col justify-between\">\r\n                <div>\r\n                    <Link href={productHref} className=\"hover:underline\">\r\n                        <h4 className=\"font-medium text-sm line-clamp-2 leading-tight mb-1 text-foreground\">{product.nombre}</h4>\r\n                    </Link>\r\n                </div>\r\n                <div className=\"mt-1\" data-nosnippet>\r\n                    <div className=\"flex items-baseline gap-2\">\r\n                        <p className=\"text-lg font-extrabold text-primary tracking-tight\">{formatCurrency(currentPrice)}</p>\r\n                        {hasSale && (\r\n                            <div className=\"flex items-baseline gap-2\">\r\n                                <p className=\"text-sm text-muted-foreground line-through\">{formatCurrency(beforePrice)}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </CardContent>\r\n\r\n            <CardFooter className=\"p-3 pt-0\">\r\n                <Button\r\n                    onClick={handleAddToCart}\r\n                    className={`w-full h-9 font-semibold rounded-lg transition-all shadow-sm flex items-center justify-center gap-2 ${isAdded ? 'bg-green-600 hover:bg-green-700' : 'bg-primary text-primary-foreground hover:bg-primary/90'}`}\r\n                >\r\n                    {isAdded ? (\r\n                        <span>Â¡Agregado!</span>\r\n                    ) : (\r\n                        <>\r\n                            <Plus className=\"h-4 w-4\" />\r\n                            <span>Agregar</span>\r\n                        </>\r\n                    )}\r\n                </Button>\r\n            </CardFooter>\r\n        </Card>\r\n    )\r\n}\r\n"],"names":[],"mappings":"uDAEA,EAAA,EAAA,CAAA,CAAA,OAEA,SAAS,EAAK,WAAE,CAAS,CAAE,GAAG,EAAoC,EAChE,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,YAAU,OACV,UAAW,CAAA,EAAA,EAAA,EAAA,AAAE,EACX,oFACA,GAED,GAAG,CAAK,EAGf,CAEA,SAAS,EAAW,WAAE,CAAS,CAAE,GAAG,EAAoC,EACtE,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,YAAU,cACV,UAAW,CAAA,EAAA,EAAA,EAAA,AAAE,EACX,2JACA,GAED,GAAG,CAAK,EAGf,CAEA,SAAS,EAAU,WAAE,CAAS,CAAE,GAAG,EAAoC,EACrE,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,YAAU,aACV,UAAW,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,6BAA8B,GAC3C,GAAG,CAAK,EAGf,CAyBA,SAAS,EAAY,WAAE,CAAS,CAAE,GAAG,EAAoC,EACvE,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,YAAU,eACV,UAAW,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,OAAQ,GACrB,GAAG,CAAK,EAGf,CAEA,SAAS,EAAW,CAAE,WAAS,CAAE,GAAG,EAAoC,EACtE,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,YAAU,cACV,UAAW,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,0CAA2C,GACxD,GAAG,CAAK,EAGf,0IC9EA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OASO,SAAS,EAAY,SAAE,CAAO,CAAE,gBAAgB,EAAK,CAAoB,EAC5E,IAAM,EAAU,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,AAAC,GAAU,EAAM,OAAO,EAC/C,EAAiB,CAAA,EAAA,EAAA,qBAAqB,AAArB,EAAuB,AAAD,GAAW,EAAM,cAAc,EACtE,EAAW,CAAA,EAAA,EAAA,MAAA,AAAM,EAAiB,MAClC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAEjC,EAAe,OAAQ,GAAiB,QAAU,GAClD,EAAc,OAAQ,GAAiB,cAAgB,GACvD,EAAU,OAAO,QAAQ,CAAC,IAAgB,EAAc,GAAK,OAAO,QAAQ,CAAC,IAAiB,EAAe,GAAK,EAAc,EAChI,EAAkB,EAAU,KAAK,KAAK,CAAC,CAAC,EAAI,EAAe,CAAA,CAAW,CAAI,KAAO,EAEjF,EACF,CAAC,MAAM,OAAO,CAAE,EAAgB,QAAQ,EAAM,EAAgB,QAAQ,CAAgB,EAAA,AAAE,EACnF,MAAM,CAAC,SACP,MAAM,CAAC,AAAC,IACL,IAAM,EAAI,OAAO,GAAK,IAAI,WAAW,GACrC,MAAO,CAAC,CAAC,EAAE,QAAQ,CAAC,SAAW,EAAE,QAAQ,CAAC,UAAY,EAAE,QAAQ,CAAC,SAAW,EAAE,QAAQ,CAAC,OAAA,CAC3F,AADkG,GAEjG,KAAK,CAAC,EAAG,IAEZ,EAAiB,EAAO,MAAM,CAAG,EAAI,EAAS,EAAQ,UAAU,CAAG,CAAC,EAAQ,UAAU,CAAC,CAAG,EAAE,CAE5F,EAAc,CAAA,EAAA,EAAA,qBAAA,AAAqB,EAAC,AAAC,GAAU,EAAM,WAAW,EAkBhE,EAAc,CAAC,WAAW,EAAE,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAQ,MAAM,EAAE,CAAC,EAAE,EAAQ,EAAE,CAAA,CAAE,CAEzE,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,qIACZ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAM,EAAa,UAAU,iBAC/B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oDAAoD,IAAK,YACnE,EAAe,MAAM,CAAG,EACrB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,oBAAoB,CAAA,CACjB,OAAQ,EACR,IAAK,EAAQ,MAAM,CACnB,UAAU,0DACV,QAAQ,CAAA,CAAA,EACR,WAAY,KACZ,SAAU,EACV,MAAM,0DACN,QAAS,KAGb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2IACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAS,CAAA,CAAC,UAAU,2BAI7B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0FAEd,GACG,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACX,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,0LAAgL,IAC1L,EAAgB,cAOtC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,qDACnB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UACG,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAM,EAAa,UAAU,2BAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,+EAAuE,EAAQ,MAAM,OAG3G,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,OAAO,gBAAc,CAAA,CAAA,WAChC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sCACX,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8DAAsD,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,KACjF,GACG,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qCACX,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sDAA8C,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,eAO9F,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,UAAU,oBAClB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACH,QAvES,AAAD,CAuEC,GAjErB,GALA,EAAE,cAAc,GAEhB,CAFmB,CAEX,GACR,EAAY,IAER,EAAS,OAAO,EAAI,EAAe,MAAM,CAAG,EAAG,CAC/C,IAAM,EAAO,EAAS,OAAO,CAAC,qBAAqB,GACnD,EAAe,CAAc,CAAC,EAAE,CAAE,EACtC,CAGA,GAAW,GAXiG,AAY5G,WAAW,IAAM,GAAW,GAAQ,IACxC,EA0DgB,UAAW,CAAC,oGAAoG,EAAE,EAAU,kCAAoC,yDAAA,CAA0D,UAEzN,EACG,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,eAEN,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,YAChB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,qBAOlC"}