{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Martin/Desktop/PROYECTOS/Tienda-Blama-2026/app/productos/%5Bid%5D/producto-detalle-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/productos/[id]/producto-detalle-client.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/productos/[id]/producto-detalle-client.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkT,GAC/U,gFACA","ignoreList":[0]}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Martin/Desktop/PROYECTOS/Tienda-Blama-2026/app/productos/%5Bid%5D/producto-detalle-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/productos/[id]/producto-detalle-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/productos/[id]/producto-detalle-client.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA8R,GAC3T,4DACA","ignoreList":[0]}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Martin/Desktop/PROYECTOS/Tienda-Blama-2026/features/products/services/products.server.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\"\r\nimport type { Category, Product } from \"@/features/products/types\"\r\n\r\nfunction createAnonServerClient() {\r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n    const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n    if (!supabaseUrl || !supabaseAnonKey) return null\r\n    return createClient(supabaseUrl, supabaseAnonKey, {\r\n        auth: { persistSession: false },\r\n    })\r\n}\r\n\r\nexport async function fetchProductForMeta(id: number) {\r\n    const supabase = createAnonServerClient()\r\n    if (!supabase) return null\r\n\r\n    const { data, error } = await supabase\r\n        .from(\"productos\")\r\n        .select(\"id, nombre, descripcion, imagen_url, imagenes\")\r\n        .eq(\"id\", id)\r\n        .maybeSingle()\r\n\r\n    if (error) return null\r\n    return data\r\n}\r\n\r\nexport async function getHomePageData(opts: {\r\n    selectedCategorySlug?: string\r\n    featuredQuery: string\r\n    productsLimit: number\r\n}) {\r\n    const supabase = createAnonServerClient()\r\n    if (!supabase) {\r\n        return {\r\n            categories: [] as Category[],\r\n            featuredProduct: null as Product | null,\r\n            products: [] as Product[],\r\n            bestSellers: [] as Product[],\r\n            offers: [] as Product[],\r\n            productsError: null as any,\r\n        }\r\n    }\r\n\r\n    const { data: categories } = await supabase.from(\"categorias\").select(\"*\").order(\"nombre\", { ascending: true })\r\n\r\n    const selectedCategorySlug = String(opts.selectedCategorySlug || \"\").trim()\r\n    const selectedCategory = (categories as Category[] | null)?.find((c) => c.slug === selectedCategorySlug)\r\n\r\n    const { data: featuredProduct } = await supabase\r\n        .from(\"productos\")\r\n        .select(\"*\")\r\n        .ilike(\"nombre\", opts.featuredQuery)\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(1)\r\n        .maybeSingle()\r\n\r\n    let productsQuery = supabase.from(\"productos\").select(\"*\").order(\"created_at\", { ascending: false })\r\n    productsQuery = productsQuery.limit(opts.productsLimit)\r\n\r\n    if ((selectedCategory as any)?.id) {\r\n        const catId = (selectedCategory as any).id\r\n        const allCats = (categories as any[]) || []\r\n        const childIds = allCats.filter(c => c.parent_id === catId).map(c => c.id)\r\n        const ids = [catId, ...childIds]\r\n        productsQuery = productsQuery.in(\"categoria_id\", ids)\r\n    }\r\n    const { data: products, error: productsError } = await productsQuery\r\n\r\n    let bestSellers: Product[] = []\r\n    let offers: Product[] = []\r\n\r\n    try {\r\n        const { data: soldItems, error: soldItemsError } = await supabase\r\n            .from(\"pedido_items\")\r\n            .select(`\r\n        cantidad,\r\n        productos (*),\r\n        pedidos (status)\r\n      `)\r\n            .limit(1000)\r\n\r\n        if (!soldItemsError && soldItems && soldItems.length > 0) {\r\n            const soldByProductId = new Map<number, { product: Product; sold: number }>()\r\n\r\n            for (const row of soldItems as any[]) {\r\n                const status: string | undefined = row.pedidos?.status\r\n                if (status && [\"Fallido\", \"Devuelto\"].includes(status)) continue\r\n\r\n                const product: Product | null | undefined = row.productos\r\n                if (!product) continue\r\n\r\n                const productId = product.id\r\n                const qty = Number(row.cantidad) || 0\r\n                if (qty <= 0) continue\r\n\r\n                const current = soldByProductId.get(productId)\r\n                if (current) {\r\n                    current.sold += qty\r\n                } else {\r\n                    soldByProductId.set(productId, { product, sold: qty })\r\n                }\r\n            }\r\n\r\n            bestSellers = Array.from(soldByProductId.values())\r\n                .sort((a, b) => b.sold - a.sold)\r\n                .slice(0, 10)\r\n                .map((x) => x.product)\r\n        }\r\n    } catch (err) {\r\n        bestSellers = []\r\n    }\r\n\r\n    try {\r\n        const { data: offersRaw, error: offersError } = await supabase\r\n            .from(\"productos\")\r\n            .select(\"*\")\r\n            .not(\"precio_antes\", \"is\", null)\r\n            .limit(60)\r\n\r\n        if (!offersError && offersRaw && offersRaw.length > 0) {\r\n            offers = (offersRaw as Product[])\r\n                .filter((p) => {\r\n                    const before = Number((p as any)?.precio_antes ?? 0)\r\n                    const current = Number((p as any)?.precio ?? 0)\r\n                    return Number.isFinite(before) && Number.isFinite(current) && before > current && current > 0\r\n                })\r\n                .sort((a, b) => {\r\n                    const beforeA = Number((a as any)?.precio_antes ?? 0)\r\n                    const currentA = Number((a as any)?.precio ?? 0)\r\n                    const beforeB = Number((b as any)?.precio_antes ?? 0)\r\n                    const currentB = Number((b as any)?.precio ?? 0)\r\n                    const discA = beforeA > 0 ? (beforeA - currentA) / beforeA : 0\r\n                    const discB = beforeB > 0 ? (beforeB - currentB) / beforeB : 0\r\n                    return discB - discA\r\n                })\r\n                .slice(0, 6)\r\n        }\r\n    } catch (err) {\r\n        offers = []\r\n    }\r\n\r\n    const visibleCategories = ((categories as Category[]) || []).filter((c: any) => !c.parent_id)\r\n\r\n    return {\r\n        categories: visibleCategories,\r\n        featuredProduct: (featuredProduct as Product | null) || null,\r\n        products: (products as Product[] | null) || [],\r\n        bestSellers,\r\n        offers,\r\n        productsError,\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Martin/Desktop/PROYECTOS/Tienda-Blama-2026/app/productos/%5Bid%5D/page.tsx"],"sourcesContent":["import type { Metadata } from \"next\"\r\nimport ProductoDetalleClient from \"./producto-detalle-client\"\r\nimport { fetchProductForMeta } from \"@/features/products/services/products.server\"\r\n\r\nfunction parseProductId(raw: string) {\r\n    const direct = Number(raw)\r\n    if (Number.isFinite(direct) && direct > 0) return direct\r\n    const match = String(raw).match(/(\\d+)(?:\\D*)$/)\r\n    if (match && match[1]) return Number(match[1])\r\n    return 0\r\n}\r\n\r\nfunction buildDescription(p: any) {\r\n    const raw = String(p?.descripcion || \"\").trim()\r\n    const safe = raw.replace(/\\s+/g, \" \").slice(0, 160)\r\n    if (safe) return safe\r\n    return \"Compra online con entrega r√°pida y compra segura.\"\r\n}\r\n\r\nexport async function generateMetadata({\r\n    params,\r\n}: {\r\n    params: Promise<{ id: string }>\r\n}): Promise<Metadata> {\r\n    const resolvedParams = await params\r\n    const id = parseProductId(resolvedParams.id)\r\n    if (!id) {\r\n        return {\r\n            title: \"Producto\",\r\n            description: \"Detalle de producto\",\r\n        }\r\n    }\r\n\r\n    const product = await fetchProductForMeta(id)\r\n    if (!product) {\r\n        return {\r\n            title: \"Producto\",\r\n            description: \"Detalle de producto\",\r\n        }\r\n    }\r\n\r\n    const title = String((product as any).nombre || \"Producto\")\r\n    const description = buildDescription(product)\r\n    const imgs = Array.isArray((product as any).imagenes) ? ((product as any).imagenes as string[]).filter(Boolean) : []\r\n    const primaryImage = imgs[0] || String((product as any).imagen_url || \"\")\r\n\r\n    return {\r\n        title,\r\n        description,\r\n        openGraph: {\r\n            title,\r\n            description,\r\n            images: primaryImage ? [{ url: primaryImage }] : [],\r\n        },\r\n        twitter: {\r\n            card: \"summary_large_image\",\r\n            title,\r\n            description,\r\n            images: primaryImage ? [primaryImage] : [],\r\n        },\r\n    }\r\n}\r\n\r\nexport default function ProductoDetallePage() {\r\n    return <ProductoDetalleClient />\r\n}\r\n"],"names":[],"mappings":";;;;;;;AACA;AACA;;;;AAEA,SAAS,eAAe,GAAW;IAC/B,MAAM,SAAS,OAAO;IACtB,IAAI,OAAO,QAAQ,CAAC,WAAW,SAAS,GAAG,OAAO;IAClD,MAAM,QAAQ,OAAO,KAAK,KAAK,CAAC;IAChC,IAAI,SAAS,KAAK,CAAC,EAAE,EAAE,OAAO,OAAO,KAAK,CAAC,EAAE;IAC7C,OAAO;AACX;AAEA,SAAS,iBAAiB,CAAM;IAC5B,MAAM,MAAM,OAAO,GAAG,eAAe,IAAI,IAAI;IAC7C,MAAM,OAAO,IAAI,OAAO,CAAC,QAAQ,KAAK,KAAK,CAAC,GAAG;IAC/C,IAAI,MAAM,OAAO;IACjB,OAAO;AACX;AAEO,eAAe,iBAAiB,EACnC,MAAM,EAGT;IACG,MAAM,iBAAiB,MAAM;IAC7B,MAAM,KAAK,eAAe,eAAe,EAAE;IAC3C,IAAI,CAAC,IAAI;QACL,OAAO;YACH,OAAO;YACP,aAAa;QACjB;IACJ;IAEA,MAAM,UAAU,MAAM,IAAA,6KAAmB,EAAC;IAC1C,IAAI,CAAC,SAAS;QACV,OAAO;YACH,OAAO;YACP,aAAa;QACjB;IACJ;IAEA,MAAM,QAAQ,OAAO,AAAC,QAAgB,MAAM,IAAI;IAChD,MAAM,cAAc,iBAAiB;IACrC,MAAM,OAAO,MAAM,OAAO,CAAC,AAAC,QAAgB,QAAQ,IAAI,AAAC,AAAC,QAAgB,QAAQ,CAAc,MAAM,CAAC,WAAW,EAAE;IACpH,MAAM,eAAe,IAAI,CAAC,EAAE,IAAI,OAAO,AAAC,QAAgB,UAAU,IAAI;IAEtE,OAAO;QACH;QACA;QACA,WAAW;YACP;YACA;YACA,QAAQ,eAAe;gBAAC;oBAAE,KAAK;gBAAa;aAAE,GAAG,EAAE;QACvD;QACA,SAAS;YACL,MAAM;YACN;YACA;YACA,QAAQ,eAAe;gBAAC;aAAa,GAAG,EAAE;QAC9C;IACJ;AACJ;AAEe,SAAS;IACpB,qBAAO,8OAAC,uKAAqB;;;;;AACjC"}}]
}