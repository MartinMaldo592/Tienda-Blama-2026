(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78745,e=>{"use strict";let a=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["default",()=>a])},27989,20916,65658,98330,16282,31289,75611,33923,62794,12666,28276,63508,e=>{"use strict";var a=e.i(53210);async function t(e){let t=String(e.role||"worker"),r=String(e.currentUserId||""),{data:s}=await a.supabase.from("pedidos").select("id, total, status, asignado_a, created_at"),i=(s||[]).filter(e=>"Entregado"===e.status),o=i.reduce((e,a)=>e+(Number(a.total)||0),0),n=new Date,d=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0"),u=`${d}-${l}-${c}`,p=i.filter(e=>"string"==typeof e.created_at&&e.created_at.startsWith(u)).reduce((e,a)=>e+(Number(a.total)||0),0),f=(s||[]).filter(e=>"Pendiente"===e.status).length,m=(s||[]).filter(e=>["Confirmado","Preparando","Enviado"].includes(e.status)).length,h=i.length,b=(s||[]).filter(e=>e.asignado_a===r&&!["Fallido","Devuelto","Entregado"].includes(e.status)).length,g=0;if("admin"===t){let{count:e}=await a.supabase.from("clientes").select("*",{count:"exact",head:!0});g=e||0}let w=0;if("admin"===t){let{count:e}=await a.supabase.from("productos").select("*",{count:"exact",head:!0}).lt("stock",5);w=e||0}return{totalVentasReales:o,ventasHoy:p,pedidosPendientes:f,pedidosEnProceso:m,pedidosEntregados:h,pedidosAsignados:b,totalClientes:g,productosLowStock:w}}async function r(e){let t=e.from?`${e.from}T00:00:00.000Z`:void 0,r=e.to?`${e.to}T23:59:59.999Z`:void 0,s=a.supabase.from("pedidos").select("id, total, status, created_at, clientes (nombre, telefono, dni)").eq("status","Entregado").order("created_at",{ascending:!1});t&&(s=s.gte("created_at",t)),r&&(s=s.lte("created_at",r));let{data:i,error:o}=await s;if(o)throw o;return i||[]}async function s(e){let t=Number(e.threshold),{data:r,error:s}=await a.supabase.from("productos").select("id, nombre, precio, stock, imagen_url").lt("stock",t).order("stock",{ascending:!0});if(s)throw s;return r||[]}async function i(){let{data:e,error:t}=await a.supabase.from("pedidos").select("id, total, status, created_at, clientes (nombre, telefono, dni)").eq("status","Pendiente").order("created_at",{ascending:!1});if(t)throw t;return e||[]}let o=["Confirmado","Preparando","Enviado"];async function n(e){let t=e.from?`${e.from}T00:00:00.000Z`:void 0,r=e.to?`${e.to}T23:59:59.999Z`:void 0,s=a.supabase.from("pedidos").select("id, total, status, created_at, asignado_a, clientes (nombre, telefono, dni)").in("status",o).order("created_at",{ascending:!1});"all"!==e.status&&(s=s.eq("status",e.status)),t&&(s=s.gte("created_at",t)),r&&(s=s.lte("created_at",r));let{data:i,error:n}=await s;if(n)throw n;return i||[]}async function d(){let{data:e,error:t}=await a.supabase.from("profiles").select("id, email, nombre, role").eq("role","worker");if(t)throw t;return e||[]}async function l(e){let t=String(e.role||"worker"),r=String(e.currentUserId||""),s=a.supabase.from("pedidos").select(`
        *,
        clientes (nombre, telefono, dni)
      `).order("created_at",{ascending:!1});"worker"===t&&(s=s.eq("asignado_a",r));let{data:i,error:o}=await s;if(o){if(String(o.message||"").includes("asignado_a")){let{data:e}=await a.supabase.from("pedidos").select("*, clientes (nombre, telefono, dni)").order("created_at",{ascending:!1});return e||[]}throw o}return await Promise.all((i||[]).map(async e=>{if(e.asignado_a){let{data:t}=await a.supabase.from("profiles").select("id, email, nombre").eq("id",e.asignado_a).single();return{...e,asignado_perfil:t||null}}return{...e,asignado_perfil:null}}))}async function c(e){let t=e.workerId?String(e.workerId):null,{error:r}=await a.supabase.from("pedidos").update({asignado_a:t,fecha_asignacion:t?new Date().toISOString():null}).eq("id",e.pedidoId);if(r)throw r}async function u(e){let{data:t,error:r}=await a.supabase.from("pedidos").select(`
        *,
        clientes (*)
      `).eq("id",e).single();if(r)throw r;let s=null;if(t?.asignado_a){let{data:e}=await a.supabase.from("profiles").select("id, email, nombre").eq("id",t.asignado_a).single();s=e}let i={...t,asignado_perfil:s},{data:o,error:n}=await a.supabase.from("pedido_items").select(`
        *,
        productos (nombre, precio, imagen_url)
      `).eq("pedido_id",e);if(n)throw n;return{pedido:i,items:o||[]}}async function p(e){let t=Number(e.pedidoId),r=String(e.nextStatus||"");if("Confirmado"===r&&!e.stockDescontado){let{data:e,error:r}=await a.supabase.from("pedido_items").select("producto_id, producto_variante_id, cantidad").eq("pedido_id",t);if(r)throw r;for(let t of(e||[]).filter(e=>e.producto_id)){let e=Number(t.producto_id),r=null!=t.producto_variante_id?Number(t.producto_variante_id):null,s=Number(t.cantidad||0);if(e&&!(s<=0))if(r){let{data:e,error:t}=await a.supabase.from("producto_variantes").select("stock").eq("id",r).single();if(t)throw t;let i=Math.max(0,Number(e?.stock??0)-s),{error:o}=await a.supabase.from("producto_variantes").update({stock:i}).eq("id",r);if(o)throw o}else{let{data:t,error:r}=await a.supabase.from("productos").select("stock").eq("id",e).single();if(r)throw r;let i=Math.max(0,Number(t?.stock??0)-s),{error:o}=await a.supabase.from("productos").update({stock:i}).eq("id",e);if(o)throw o}}let{error:s}=await a.supabase.from("pedidos").update({stock_descontado:!0}).eq("id",t);if(s)throw s}let{error:s}=await a.supabase.from("pedidos").update({status:r}).eq("id",t);if(s)throw s}async function f(){let{data:e,error:t}=await a.supabase.from("productos").select("*").order("id",{ascending:!0});if(t)throw t;return e||[]}async function m(e){let{data:t,error:r}=await a.supabase.from("productos").select("*").eq("id",e).single();if(r)throw r;return t}async function h(){let{data:e,error:t}=await a.supabase.from("categorias").select("*");if(t)throw t;return e||[]}async function b(e){let t=String(e.nombre||"").trim(),r=t.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),{data:s,error:i}=await a.supabase.from("categorias").insert({nombre:t,slug:r}).select().single();if(i)throw i;return s}async function g(e){let[t,r]=await Promise.all([a.supabase.from("producto_especificaciones").select("*").eq("producto_id",e).order("orden",{ascending:!0}).order("id",{ascending:!0}),a.supabase.from("producto_variantes").select("*").eq("producto_id",e).order("id",{ascending:!0})]);return{specs:t.data||[],variants:r.data||[]}}async function w(e){let t=Array.isArray(e.files)?e.files:[],r=[];for(let e of t){let t=e.name.split(".").pop()||"jpg",s=`${Date.now()}-${Math.random().toString(16).slice(2)}.${t}`,i=`imagenes/${s}`,{error:o}=await a.supabase.storage.from("productos").upload(i,e);if(o)throw o;let{data:n}=a.supabase.storage.from("productos").getPublicUrl(i);n?.publicUrl&&r.push(n.publicUrl)}return r}async function y(e){let t=Array.isArray(e.files)?e.files:[],r=[];for(let e of t){let t=e.name.split(".").pop()||"mp4",s=`${Date.now()}-${Math.random().toString(16).slice(2)}.${t}`,i=`videos/${s}`,{error:o}=await a.supabase.storage.from("productos").upload(i,e,{upsert:!1,contentType:e.type||"video/mp4"});if(o)throw o;let{data:n}=a.supabase.storage.from("productos").getPublicUrl(i);n?.publicUrl&&r.push(n.publicUrl)}return r}async function x(e){let a=await fetch("/api/admin/productos",{method:e.method,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify(e.body)}),t=null;try{t=await a.json()}catch(e){t=null}if(!a.ok||!t?.ok)throw Error(String(t?.error||"No se pudo guardar el producto"));return t}async function _(e){let a=await fetch("/api/admin/productos",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({id:e.id})}),t=null;try{t=await a.json()}catch(e){t=null}if(!a.ok||!t?.ok)throw Error(String(t?.error||"No se pudo eliminar"));return t}async function j(){let{data:e,error:t}=await a.supabase.from("profiles").select("id, email, nombre, role, created_at").order("created_at",{ascending:!1});if(t)throw t;return e||[]}async function v(e){let a=await fetch("/api/admin/create-worker",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({email:e.email,nombre:e.nombre,password:e.password})}),t=await a.json();if(!a.ok)throw Error(String(t?.error||"Error"));return t}async function S(){let{data:e,error:t}=await a.supabase.from("cupones").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}async function k(e){let{error:t}=await a.supabase.from("cupones").insert(e);if(t)throw t}async function N(e,t){let{error:r}=await a.supabase.from("cupones").update(t).eq("id",e);if(r)throw r}async function A(e){let{error:t}=await a.supabase.from("cupones").delete().eq("id",e);if(t)throw t}async function T(){let{data:e,error:t}=await a.supabase.from("home_banners").select("*").order("orden",{ascending:!0}).order("id",{ascending:!0});if(t)throw t;return e||[]}async function C(e){if(null!=e.id){let{error:t}=await a.supabase.from("home_banners").update(e.payload).eq("id",e.id);if(t)throw t;return}let{error:t}=await a.supabase.from("home_banners").insert(e.payload);if(t)throw t}async function q(e){let{error:t}=await a.supabase.from("home_banners").delete().eq("id",e);if(t)throw t}async function P(){let e=await a.supabase.auth.getSession();return e?.data?.session?.access_token||""}async function E(){let e=await P();if(!e)throw Error("No autorizado");let a=await fetch("/api/admin/announcement-bar",{method:"GET",headers:{Authorization:`Bearer ${e}`}}),t=null;try{t=await a.json()}catch(e){t=null}if(!a.ok||!t?.ok)throw Error(String(t?.error||"No se pudo obtener la configuración"));let r=t?.data||{};return{enabled:!!r.enabled,interval_ms:Number(r.interval_ms)||3500,messages:Array.isArray(r.messages)?r.messages:[]}}async function I(e){let a=await P();if(!a)throw Error("No autorizado");let t=await fetch("/api/admin/announcement-bar",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)}),r=null;try{r=await t.json()}catch(e){r=null}if(!t.ok||!r?.ok)throw Error(String(r?.error||"No se pudo guardar"));return r}async function $(){let{data:e,error:t}=await a.supabase.from("pedidos").select("id, status, created_at, clientes (nombre, telefono)").order("created_at",{ascending:!1}).limit(200);if(t)throw t;return e||[]}async function B(){let{data:e,error:t}=await a.supabase.from("incidencias").select("*, pedidos (id, status, created_at, clientes (nombre, telefono))").order("created_at",{ascending:!1});if(t)throw t;return e||[]}async function D(e){let t=String(e.pedidoId||"").trim(),r=Array.isArray(e.files)?e.files:[],s=[];for(let e of r){let r=e.name.split(".").pop()||"jpg",i=`${Date.now()}-${Math.random().toString(16).slice(2)}.${r}`,o=t?`incidencias/${t}`:"incidencias",n=`${o}/${i}`,{error:d}=await a.supabase.storage.from("productos").upload(n,e);if(d)throw d;let{data:l}=a.supabase.storage.from("productos").getPublicUrl(n);l?.publicUrl&&s.push(l.publicUrl)}return s}async function R(e){async function t(t){let r={...e};return t||delete r.fotos,a.supabase.from("incidencias").insert(r)}let r=(await t(!0)).error;if(r&&"string"==typeof r.message&&r.message.toLowerCase().includes("fotos")&&(r=(await t(!1)).error),r)throw Error(r.message)}async function U(e){let{error:t}=await a.supabase.from("incidencias").delete().eq("id",e);if(t)throw t}async function H(){let{data:e,error:t}=await a.supabase.from("product_questions").select("id, product_id, question, asker_name, asker_phone, published, created_at, productos(nombre), product_answers(id, answer, answered_by, created_at, published)").order("created_at",{ascending:!1}).limit(200);if(t)throw t;return e||[]}async function M(e){let{error:t}=await a.supabase.from("product_questions").update({published:e.published}).eq("id",e.id);if(t)throw t}async function V(e){let t=String(e.answer||"").trim(),{data:r}=await a.supabase.auth.getSession(),s=r?.session?.user?.id||null,i=null;if(s){let{data:e}=await a.supabase.from("profiles").select("email, nombre").eq("id",s).maybeSingle();i=String(e?.nombre||e?.email||"Admin")}let{data:o}=await a.supabase.from("product_questions").select("id, product_answers(id)").eq("id",e.questionId).maybeSingle(),n=o&&Array.isArray(o.product_answers)&&o.product_answers.length>0?Number(o.product_answers[0]?.id):null;if(n){let{error:e}=await a.supabase.from("product_answers").update({answer:t,answered_by:i,published:!0}).eq("id",n);if(e)throw e}else{let{error:r}=await a.supabase.from("product_answers").insert({question_id:e.questionId,answer:t,answered_by:i,published:!0});if(r)throw r}let{error:d}=await a.supabase.from("product_questions").update({published:!0}).eq("id",e.questionId);if(d)throw d}async function O(){let{data:e,error:t}=await a.supabase.from("product_reviews").select("id, product_id, rating, title, body, customer_name, customer_city, verified, approved, created_at, productos(nombre)").order("created_at",{ascending:!1}).limit(200);if(t)throw t;return e||[]}async function z(e){let{error:t}=await a.supabase.from("product_reviews").update({approved:e.approved}).eq("id",e.id);if(t)throw t}async function F(e){let{error:t}=await a.supabase.from("product_reviews").delete().eq("id",e);if(t)throw t}async function L(){let{data:e,error:t}=await a.supabase.from("clientes").select("*").order("id",{ascending:!1});if(t)throw t;return e||[]}e.s(["fetchAdminDashboardStats",()=>t,"fetchAdminPedidosEnProceso",()=>n,"fetchAdminPedidosPendientes",()=>i,"fetchAdminStockBajo",()=>s,"fetchAdminVentasEntregadas",()=>r],20916),e.s(["assignPedidoToWorker",()=>c,"fetchAdminWorkers",()=>d,"fetchPedidoDetail",()=>u,"fetchPedidosForRole",()=>l,"updatePedidoStatusWithStock",()=>p],65658),e.s(["createAdminCategoria",()=>b,"deleteAdminProductoViaApi",()=>_,"fetchAdminCategorias",()=>h,"fetchAdminProductoById",()=>m,"fetchAdminProductos",()=>f,"fetchProductoSpecsAndVariants",()=>g,"saveAdminProductoViaApi",()=>x,"uploadProductImages",()=>w,"uploadProductVideos",()=>y],98330),e.s(["createWorkerViaApi",()=>v,"fetchAdminProfiles",()=>j],16282),e.s(["createAdminCupon",()=>k,"deleteAdminCupon",()=>A,"fetchAdminCupones",()=>S,"updateAdminCupon",()=>N],31289),e.s(["deleteHomeBanner",()=>q,"fetchHomeBanners",()=>T,"saveHomeBanner",()=>C],75611),e.s(["fetchAnnouncementBarConfigViaApi",()=>E,"saveAnnouncementBarConfigViaApi",()=>I],33923),e.s(["createIncidencia",()=>R,"deleteIncidencia",()=>U,"fetchIncidencias",()=>B,"fetchPedidosForIncidencias",()=>$,"uploadIncidenciaImages",()=>D],62794),e.s(["fetchAdminQuestions",()=>H,"saveQuestionAnswer",()=>V,"setQuestionPublished",()=>M],12666),e.s(["deleteReview",()=>F,"fetchAdminReviews",()=>O,"setReviewApproved",()=>z],28276),e.s(["fetchAdminClientes",()=>L],63508),e.s([],27989)},47627,e=>{"use strict";var a=e.i(43476),t=e.i(47163);function r({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,t.cn)("w-full caption-bottom text-sm",e),...r})})}function s({className:e,...r}){return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,t.cn)("[&_tr]:border-b",e),...r})}function i({className:e,...r}){return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,t.cn)("[&_tr:last-child]:border-0",e),...r})}function o({className:e,...r}){return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,t.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function n({className:e,...r}){return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,t.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function d({className:e,...r}){return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,t.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}e.s(["Table",()=>r,"TableBody",()=>i,"TableCell",()=>d,"TableHead",()=>n,"TableHeader",()=>s,"TableRow",()=>o])},16715,e=>{"use strict";let a=(0,e.i(75254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>a],16715)},84614,e=>{"use strict";let a=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>a],84614)},60940,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(53210),s=e.i(87863),i=e.i(27488),o=e.i(47627),n=e.i(67881),d=e.i(23750),l=e.i(62870),c=e.i(47163),u=e.i(75254);let p=(0,u.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var f=e.i(55436);let m=(0,u.default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var h=e.i(16715),b=e.i(84614),g=e.i(22016);e.i(27989);var w=e.i(65658);function y(){let[e,u]=(0,t.useState)([]),[y,_]=(0,t.useState)([]),[j,v]=(0,t.useState)(!0),[S,k]=(0,t.useState)("worker"),[N,A]=(0,t.useState)(""),[T,C]=(0,t.useState)("all"),q=(0,s.useRoleGuard)({allowedRoles:["admin","worker"]}),P=(0,t.useCallback)(async(e,a)=>{v(!0);try{let t=await (0,w.fetchPedidosForRole)({role:e,currentUserId:a});u(t)}catch(e){console.error("Error in fetchPedidos:",e)}v(!1)},[]);async function E(e,a){try{await (0,w.assignPedidoToWorker)({pedidoId:e,workerId:"unassigned"===a?null:a}),P(S,N)}catch(r){let e=String(r?.code||""),a=String(r?.message||""),t=a.toLowerCase();"42501"===e||t.includes("permission denied")||t.includes("row level security")||t.includes("violates row-level security")?alert("No tienes permisos para realizar esta acción."):alert("Error al asignar: "+a)}}(0,t.useEffect)(()=>{if(q.loading||q.accessDenied)return;let e=String(q.role||"worker");k(e),(async()=>{let{data:{session:a}}=await r.supabase.auth.getSession(),t=a?.user?.id||"";if(A(t),"admin"===e)try{let e=await (0,w.fetchAdminWorkers)();_(e)}catch(e){_([])}else _([]);await P(e,t)})()},[q.loading,q.accessDenied,q.role,P]);let I="admin"===S&&"all"!==T?e.filter(e=>"unassigned"===T?!e.asignado_a:e.asignado_a===T):e;return q.loading?(0,a.jsx)("div",{className:"p-10",children:"Cargando..."}):q.accessDenied?(0,a.jsx)(i.AccessDenied,{}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"admin"===S?"Gestión de Pedidos":"Mis Pedidos Asignados"}),(0,a.jsx)("p",{className:"text-gray-500",children:"admin"===S?"Administra y delega órdenes a tu equipo.":"Pedidos que te han sido delegados."})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:["admin"===S&&(0,a.jsx)(n.Button,{variant:"outline",className:"gap-2",onClick:function(){var e;let a,t,r,s,i=I.map(e=>({id:e.id,fecha:e.created_at,cliente:e.clientes?.nombre||"",telefono:e.clientes?.telefono||"",dni:e.clientes?.dni||"",total:e.total,status:e.status,pago_status:e.pago_status,cupon_codigo:e.cupon_codigo||"",descuento:e.descuento??"",subtotal:e.subtotal??"",asignado_a:e.asignado_a||""})),o=new Date().toISOString().slice(0,10);e=`pedidos-${o}.csv`,t=new Blob(["\uFEFF"+[(a=i.length>0?Object.keys(i[0]):[]).join(","),...i.map(e=>a.map(a=>{let t;return t=String(e[a]??""),/[\n\r,\"]/g.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(t),(s=document.createElement("a")).href=r,s.download=e,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(r)},children:"Exportar CSV"}),(0,a.jsxs)(n.Button,{variant:"outline",className:"gap-2",onClick:()=>P(S,N),children:[(0,a.jsx)(h.RefreshCw,{className:"h-4 w-4"})," Actualizar"]})]})]}),"admin"===S&&(0,a.jsxs)("div",{className:"flex gap-4 bg-white p-4 rounded-xl shadow-sm border",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(f.Search,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,a.jsx)(d.Input,{placeholder:"Buscar por cliente, ID o teléfono...",className:"pl-9 border-gray-200"})]}),(0,a.jsxs)(l.Select,{value:T,onValueChange:C,children:[(0,a.jsx)(l.SelectTrigger,{className:"w-[200px]",children:(0,a.jsx)(l.SelectValue,{placeholder:"Filtrar por trabajador"})}),(0,a.jsxs)(l.SelectContent,{children:[(0,a.jsx)(l.SelectItem,{value:"all",children:"Todos los pedidos"}),(0,a.jsx)(l.SelectItem,{value:"unassigned",children:"Sin asignar"}),y.map(e=>(0,a.jsx)(l.SelectItem,{value:e.id,children:e.nombre||e.email},e.id))]})]})]}),"worker"===S&&0===e.length&&!j&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-12 text-center",children:[(0,a.jsx)("div",{className:"h-16 w-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(b.User,{className:"h-8 w-8 text-gray-400"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Sin pedidos asignados"}),(0,a.jsx)("p",{className:"text-gray-500 max-w-md mx-auto",children:"Aún no tienes pedidos delegados. El administrador te asignará pedidos cuando sea necesario."})]}),("admin"===S||e.length>0)&&(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:(0,a.jsxs)(o.Table,{children:[(0,a.jsx)(o.TableHeader,{className:"bg-gray-50",children:(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableHead,{className:"w-[100px]",children:"ID"}),(0,a.jsx)(o.TableHead,{children:"Cliente"}),(0,a.jsx)(o.TableHead,{children:"Fecha"}),(0,a.jsx)(o.TableHead,{children:"Total"}),(0,a.jsx)(o.TableHead,{children:"Estado"}),"admin"===S&&(0,a.jsx)(o.TableHead,{children:"Asignado a"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,a.jsx)(o.TableBody,{children:j?(0,a.jsx)(o.TableRow,{children:(0,a.jsx)(o.TableCell,{colSpan:"admin"===S?7:6,className:"text-center py-10",children:"Cargando pedidos..."})}):0===I.length?(0,a.jsx)(o.TableRow,{children:(0,a.jsxs)(o.TableCell,{colSpan:"admin"===S?7:6,className:"text-center py-10",children:["No hay pedidos ","all"!==T?"con este filtro":"","."]})}):I.map(e=>(0,a.jsxs)(o.TableRow,{children:[(0,a.jsxs)(o.TableCell,{className:"font-mono font-medium",children:["#",e.id.toString().padStart(6,"0")]}),(0,a.jsxs)(o.TableCell,{children:[(0,a.jsx)("div",{className:"font-medium",children:e.clientes?.nombre||"Anónimo"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.clientes?.telefono}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["DNI: ",e.clientes?.dni||"—"]})]}),(0,a.jsx)(o.TableCell,{children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)(o.TableCell,{className:"font-bold",children:(0,c.formatCurrency)(e.total)}),(0,a.jsx)(o.TableCell,{children:(0,a.jsx)(x,{status:e.status})}),"admin"===S&&(0,a.jsx)(o.TableCell,{children:(0,a.jsxs)(l.Select,{value:e.asignado_a||"unassigned",onValueChange:a=>E(e.id,a),children:[(0,a.jsx)(l.SelectTrigger,{className:"w-[160px] h-8 text-xs",children:(0,a.jsx)(l.SelectValue,{children:e.asignado_perfil?.nombre||e.asignado_perfil?.email||(0,a.jsxs)("span",{className:"text-orange-600 flex items-center gap-1",children:[(0,a.jsx)(m,{className:"h-3 w-3"})," Sin asignar"]})})}),(0,a.jsxs)(l.SelectContent,{children:[(0,a.jsx)(l.SelectItem,{value:"unassigned",children:(0,a.jsx)("span",{className:"text-gray-500",children:"Sin asignar"})}),y.map(e=>(0,a.jsx)(l.SelectItem,{value:e.id,children:e.nombre||e.email},e.id))]})]})}),(0,a.jsx)(o.TableCell,{className:"text-right",children:(0,a.jsx)(g.default,{href:`/admin/pedidos/${e.id}`,children:(0,a.jsx)(n.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(p,{className:"h-4 w-4 text-gray-500"})})})})]},e.id))})]})})]})}function x({status:e}){return(0,a.jsx)("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium border ${{Pendiente:"bg-yellow-100 text-yellow-800 border-yellow-200",Confirmado:"bg-blue-100 text-blue-800 border-blue-200",Preparando:"bg-purple-100 text-purple-800 border-purple-200",Enviado:"bg-indigo-100 text-indigo-800 border-indigo-200",Entregado:"bg-green-100 text-green-800 border-green-200",Fallido:"bg-red-100 text-red-800 border-red-200"}[e]||"bg-gray-100"}`,children:e})}e.s(["default",()=>y],60940)}]);