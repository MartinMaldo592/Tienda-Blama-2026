(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27989,20916,65658,98330,16282,31289,75611,33923,62794,12666,28276,63508,e=>{"use strict";var t=e.i(53210);async function a(e){let a=String(e.role||"worker"),r=String(e.currentUserId||""),{data:s}=await t.supabase.from("pedidos").select("id, total, status, asignado_a, created_at"),i=(s||[]).filter(e=>"Entregado"===e.status),n=i.reduce((e,t)=>e+(Number(t.total)||0),0),o=new Date,d=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),l=String(o.getDate()).padStart(2,"0"),u=`${d}-${c}-${l}`,m=i.filter(e=>"string"==typeof e.created_at&&e.created_at.startsWith(u)).reduce((e,t)=>e+(Number(t.total)||0),0),p=(s||[]).filter(e=>"Pendiente"===e.status).length,f=(s||[]).filter(e=>["Confirmado","Preparando","Enviado"].includes(e.status)).length,h=i.length,g=(s||[]).filter(e=>e.asignado_a===r&&!["Fallido","Devuelto","Entregado"].includes(e.status)).length,w=0;if("admin"===a){let{count:e}=await t.supabase.from("clientes").select("*",{count:"exact",head:!0});w=e||0}let b=0;if("admin"===a){let{count:e}=await t.supabase.from("productos").select("*",{count:"exact",head:!0}).lt("stock",5);b=e||0}return{totalVentasReales:n,ventasHoy:m,pedidosPendientes:p,pedidosEnProceso:f,pedidosEntregados:h,pedidosAsignados:g,totalClientes:w,productosLowStock:b}}async function r(e){let a=e.from?`${e.from}T00:00:00.000Z`:void 0,r=e.to?`${e.to}T23:59:59.999Z`:void 0,s=t.supabase.from("pedidos").select("id, total, status, created_at, clientes (nombre, telefono, dni)").eq("status","Entregado").order("created_at",{ascending:!1});a&&(s=s.gte("created_at",a)),r&&(s=s.lte("created_at",r));let{data:i,error:n}=await s;if(n)throw n;return i||[]}async function s(e){let a=Number(e.threshold),{data:r,error:s}=await t.supabase.from("productos").select("id, nombre, precio, stock, imagen_url").lt("stock",a).order("stock",{ascending:!0});if(s)throw s;return r||[]}async function i(){let{data:e,error:a}=await t.supabase.from("pedidos").select("id, total, status, created_at, clientes (nombre, telefono, dni)").eq("status","Pendiente").order("created_at",{ascending:!1});if(a)throw a;return e||[]}let n=["Confirmado","Preparando","Enviado"];async function o(e){let a=e.from?`${e.from}T00:00:00.000Z`:void 0,r=e.to?`${e.to}T23:59:59.999Z`:void 0,s=t.supabase.from("pedidos").select("id, total, status, created_at, asignado_a, clientes (nombre, telefono, dni)").in("status",n).order("created_at",{ascending:!1});"all"!==e.status&&(s=s.eq("status",e.status)),a&&(s=s.gte("created_at",a)),r&&(s=s.lte("created_at",r));let{data:i,error:o}=await s;if(o)throw o;return i||[]}async function d(){let{data:e,error:a}=await t.supabase.from("profiles").select("id, email, nombre, role").eq("role","worker");if(a)throw a;return e||[]}async function c(e){let a=String(e.role||"worker"),r=String(e.currentUserId||""),s=t.supabase.from("pedidos").select(`
        *,
        clientes (nombre, telefono, dni)
      `).order("created_at",{ascending:!1});"worker"===a&&(s=s.eq("asignado_a",r));let{data:i,error:n}=await s;if(n){if(String(n.message||"").includes("asignado_a")){let{data:e}=await t.supabase.from("pedidos").select("*, clientes (nombre, telefono, dni)").order("created_at",{ascending:!1});return e||[]}throw n}return await Promise.all((i||[]).map(async e=>{if(e.asignado_a){let{data:a}=await t.supabase.from("profiles").select("id, email, nombre").eq("id",e.asignado_a).single();return{...e,asignado_perfil:a||null}}return{...e,asignado_perfil:null}}))}async function l(e){let a=e.workerId?String(e.workerId):null,{error:r}=await t.supabase.from("pedidos").update({asignado_a:a,fecha_asignacion:a?new Date().toISOString():null}).eq("id",e.pedidoId);if(r)throw r}async function u(e){let{data:a,error:r}=await t.supabase.from("pedidos").select(`
        *,
        clientes (*)
      `).eq("id",e).single();if(r)throw r;let s=null;if(a?.asignado_a){let{data:e}=await t.supabase.from("profiles").select("id, email, nombre").eq("id",a.asignado_a).single();s=e}let i={...a,asignado_perfil:s},{data:n,error:o}=await t.supabase.from("pedido_items").select(`
        *,
        productos (nombre, precio, imagen_url)
      `).eq("pedido_id",e);if(o)throw o;return{pedido:i,items:n||[]}}async function m(e){let a=Number(e.pedidoId),r=String(e.nextStatus||"");if("Confirmado"===r&&!e.stockDescontado){let{data:e,error:r}=await t.supabase.from("pedido_items").select("producto_id, producto_variante_id, cantidad").eq("pedido_id",a);if(r)throw r;for(let a of(e||[]).filter(e=>e.producto_id)){let e=Number(a.producto_id),r=null!=a.producto_variante_id?Number(a.producto_variante_id):null,s=Number(a.cantidad||0);if(e&&!(s<=0))if(r){let{data:e,error:a}=await t.supabase.from("producto_variantes").select("stock").eq("id",r).single();if(a)throw a;let i=Math.max(0,Number(e?.stock??0)-s),{error:n}=await t.supabase.from("producto_variantes").update({stock:i}).eq("id",r);if(n)throw n}else{let{data:a,error:r}=await t.supabase.from("productos").select("stock").eq("id",e).single();if(r)throw r;let i=Math.max(0,Number(a?.stock??0)-s),{error:n}=await t.supabase.from("productos").update({stock:i}).eq("id",e);if(n)throw n}}let{error:s}=await t.supabase.from("pedidos").update({stock_descontado:!0}).eq("id",a);if(s)throw s}let{error:s}=await t.supabase.from("pedidos").update({status:r}).eq("id",a);if(s)throw s}async function p(){let{data:e,error:a}=await t.supabase.from("productos").select("*").order("id",{ascending:!0});if(a)throw a;return e||[]}async function f(e){let{data:a,error:r}=await t.supabase.from("productos").select("*").eq("id",e).single();if(r)throw r;return a}async function h(){let{data:e,error:a}=await t.supabase.from("categorias").select("*");if(a)throw a;return e||[]}async function g(e){let a=String(e.nombre||"").trim(),r=a.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),{data:s,error:i}=await t.supabase.from("categorias").insert({nombre:a,slug:r}).select().single();if(i)throw i;return s}async function w(e){let[a,r]=await Promise.all([t.supabase.from("producto_especificaciones").select("*").eq("producto_id",e).order("orden",{ascending:!0}).order("id",{ascending:!0}),t.supabase.from("producto_variantes").select("*").eq("producto_id",e).order("id",{ascending:!0})]);return{specs:a.data||[],variants:r.data||[]}}async function b(e){let a=Array.isArray(e.files)?e.files:[],r=[];for(let e of a){let a=e.name.split(".").pop()||"jpg",s=`${Date.now()}-${Math.random().toString(16).slice(2)}.${a}`,i=`imagenes/${s}`,{error:n}=await t.supabase.storage.from("productos").upload(i,e);if(n)throw n;let{data:o}=t.supabase.storage.from("productos").getPublicUrl(i);o?.publicUrl&&r.push(o.publicUrl)}return r}async function x(e){let a=Array.isArray(e.files)?e.files:[],r=[];for(let e of a){let a=e.name.split(".").pop()||"mp4",s=`${Date.now()}-${Math.random().toString(16).slice(2)}.${a}`,i=`videos/${s}`,{error:n}=await t.supabase.storage.from("productos").upload(i,e,{upsert:!1,contentType:e.type||"video/mp4"});if(n)throw n;let{data:o}=t.supabase.storage.from("productos").getPublicUrl(i);o?.publicUrl&&r.push(o.publicUrl)}return r}async function y(e){let t=await fetch("/api/admin/productos",{method:e.method,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify(e.body)}),a=null;try{a=await t.json()}catch(e){a=null}if(!t.ok||!a?.ok)throw Error(String(a?.error||"No se pudo guardar el producto"));return a}async function v(e){let t=await fetch("/api/admin/productos",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({id:e.id})}),a=null;try{a=await t.json()}catch(e){a=null}if(!t.ok||!a?.ok)throw Error(String(a?.error||"No se pudo eliminar"));return a}async function j(){let{data:e,error:a}=await t.supabase.from("profiles").select("id, email, nombre, role, created_at").order("created_at",{ascending:!1});if(a)throw a;return e||[]}async function _(e){let t=await fetch("/api/admin/create-worker",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.accessToken}`},body:JSON.stringify({email:e.email,nombre:e.nombre,password:e.password})}),a=await t.json();if(!t.ok)throw Error(String(a?.error||"Error"));return a}async function N(){let{data:e,error:a}=await t.supabase.from("cupones").select("*").order("created_at",{ascending:!1});if(a)throw a;return e||[]}async function S(e){let{error:a}=await t.supabase.from("cupones").insert(e);if(a)throw a}async function k(e,a){let{error:r}=await t.supabase.from("cupones").update(a).eq("id",e);if(r)throw r}async function A(e){let{error:a}=await t.supabase.from("cupones").delete().eq("id",e);if(a)throw a}async function C(){let{data:e,error:a}=await t.supabase.from("home_banners").select("*").order("orden",{ascending:!0}).order("id",{ascending:!0});if(a)throw a;return e||[]}async function P(e){if(null!=e.id){let{error:a}=await t.supabase.from("home_banners").update(e.payload).eq("id",e.id);if(a)throw a;return}let{error:a}=await t.supabase.from("home_banners").insert(e.payload);if(a)throw a}async function q(e){let{error:a}=await t.supabase.from("home_banners").delete().eq("id",e);if(a)throw a}async function E(){let e=await t.supabase.auth.getSession();return e?.data?.session?.access_token||""}async function I(){let e=await E();if(!e)throw Error("No autorizado");let t=await fetch("/api/admin/announcement-bar",{method:"GET",headers:{Authorization:`Bearer ${e}`}}),a=null;try{a=await t.json()}catch(e){a=null}if(!t.ok||!a?.ok)throw Error(String(a?.error||"No se pudo obtener la configuración"));let r=a?.data||{};return{enabled:!!r.enabled,interval_ms:Number(r.interval_ms)||3500,messages:Array.isArray(r.messages)?r.messages:[]}}async function $(e){let t=await E();if(!t)throw Error("No autorizado");let a=await fetch("/api/admin/announcement-bar",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),r=null;try{r=await a.json()}catch(e){r=null}if(!a.ok||!r?.ok)throw Error(String(r?.error||"No se pudo guardar"));return r}async function T(){let{data:e,error:a}=await t.supabase.from("pedidos").select("id, status, created_at, clientes (nombre, telefono)").order("created_at",{ascending:!1}).limit(200);if(a)throw a;return e||[]}async function D(){let{data:e,error:a}=await t.supabase.from("incidencias").select("*, pedidos (id, status, created_at, clientes (nombre, telefono))").order("created_at",{ascending:!1});if(a)throw a;return e||[]}async function B(e){let a=String(e.pedidoId||"").trim(),r=Array.isArray(e.files)?e.files:[],s=[];for(let e of r){let r=e.name.split(".").pop()||"jpg",i=`${Date.now()}-${Math.random().toString(16).slice(2)}.${r}`,n=a?`incidencias/${a}`:"incidencias",o=`${n}/${i}`,{error:d}=await t.supabase.storage.from("productos").upload(o,e);if(d)throw d;let{data:c}=t.supabase.storage.from("productos").getPublicUrl(o);c?.publicUrl&&s.push(c.publicUrl)}return s}async function M(e){async function a(a){let r={...e};return a||delete r.fotos,t.supabase.from("incidencias").insert(r)}let r=(await a(!0)).error;if(r&&"string"==typeof r.message&&r.message.toLowerCase().includes("fotos")&&(r=(await a(!1)).error),r)throw Error(r.message)}async function U(e){let{error:a}=await t.supabase.from("incidencias").delete().eq("id",e);if(a)throw a}async function z(){let{data:e,error:a}=await t.supabase.from("product_questions").select("id, product_id, question, asker_name, asker_phone, published, created_at, productos(nombre), product_answers(id, answer, answered_by, created_at, published)").order("created_at",{ascending:!1}).limit(200);if(a)throw a;return e||[]}async function V(e){let{error:a}=await t.supabase.from("product_questions").update({published:e.published}).eq("id",e.id);if(a)throw a}async function R(e){let a=String(e.answer||"").trim(),{data:r}=await t.supabase.auth.getSession(),s=r?.session?.user?.id||null,i=null;if(s){let{data:e}=await t.supabase.from("profiles").select("email, nombre").eq("id",s).maybeSingle();i=String(e?.nombre||e?.email||"Admin")}let{data:n}=await t.supabase.from("product_questions").select("id, product_answers(id)").eq("id",e.questionId).maybeSingle(),o=n&&Array.isArray(n.product_answers)&&n.product_answers.length>0?Number(n.product_answers[0]?.id):null;if(o){let{error:e}=await t.supabase.from("product_answers").update({answer:a,answered_by:i,published:!0}).eq("id",o);if(e)throw e}else{let{error:r}=await t.supabase.from("product_answers").insert({question_id:e.questionId,answer:a,answered_by:i,published:!0});if(r)throw r}let{error:d}=await t.supabase.from("product_questions").update({published:!0}).eq("id",e.questionId);if(d)throw d}async function L(){let{data:e,error:a}=await t.supabase.from("product_reviews").select("id, product_id, rating, title, body, customer_name, customer_city, verified, approved, created_at, productos(nombre)").order("created_at",{ascending:!1}).limit(200);if(a)throw a;return e||[]}async function W(e){let{error:a}=await t.supabase.from("product_reviews").update({approved:e.approved}).eq("id",e.id);if(a)throw a}async function O(e){let{error:a}=await t.supabase.from("product_reviews").delete().eq("id",e);if(a)throw a}async function H(){let{data:e,error:a}=await t.supabase.from("clientes").select("*").order("id",{ascending:!1});if(a)throw a;return e||[]}e.s(["fetchAdminDashboardStats",()=>a,"fetchAdminPedidosEnProceso",()=>o,"fetchAdminPedidosPendientes",()=>i,"fetchAdminStockBajo",()=>s,"fetchAdminVentasEntregadas",()=>r],20916),e.s(["assignPedidoToWorker",()=>l,"fetchAdminWorkers",()=>d,"fetchPedidoDetail",()=>u,"fetchPedidosForRole",()=>c,"updatePedidoStatusWithStock",()=>m],65658),e.s(["createAdminCategoria",()=>g,"deleteAdminProductoViaApi",()=>v,"fetchAdminCategorias",()=>h,"fetchAdminProductoById",()=>f,"fetchAdminProductos",()=>p,"fetchProductoSpecsAndVariants",()=>w,"saveAdminProductoViaApi",()=>y,"uploadProductImages",()=>b,"uploadProductVideos",()=>x],98330),e.s(["createWorkerViaApi",()=>_,"fetchAdminProfiles",()=>j],16282),e.s(["createAdminCupon",()=>S,"deleteAdminCupon",()=>A,"fetchAdminCupones",()=>N,"updateAdminCupon",()=>k],31289),e.s(["deleteHomeBanner",()=>q,"fetchHomeBanners",()=>C,"saveHomeBanner",()=>P],75611),e.s(["fetchAnnouncementBarConfigViaApi",()=>I,"saveAnnouncementBarConfigViaApi",()=>$],33923),e.s(["createIncidencia",()=>M,"deleteIncidencia",()=>U,"fetchIncidencias",()=>D,"fetchPedidosForIncidencias",()=>T,"uploadIncidenciaImages",()=>B],62794),e.s(["fetchAdminQuestions",()=>z,"saveQuestionAnswer",()=>R,"setQuestionPublished",()=>V],12666),e.s(["deleteReview",()=>O,"fetchAdminReviews",()=>L,"setReviewApproved",()=>W],28276),e.s(["fetchAdminClientes",()=>H],63508),e.s([],27989)},78745,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["default",()=>t])},56909,e=>{"use strict";let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},43432,e=>{"use strict";let t=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>t],43432)},94179,e=>{"use strict";var t=e.i(43476),a=e.i(91918),r=e.i(25913),s=e.i(47163);let i=(0,r.cva)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:r,asChild:n=!1,...o}){let d=n?a.Slot:"span";return(0,t.jsx)(d,{"data-slot":"badge",className:(0,s.cn)(i({variant:r}),e),...o})}e.s(["Badge",()=>n])},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},61659,e=>{"use strict";let t=(0,e.i(75254).default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);e.s(["CreditCard",()=>t],61659)},17153,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),s=e.i(87863),i=e.i(27488),n=e.i(67881),o=e.i(94179),d=e.i(62870),c=e.i(71689),l=e.i(46897),u=e.i(43432),m=e.i(84614),p=e.i(61659),f=e.i(56909);let h=(0,e.i(75254).default)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var g=e.i(47163);e.i(27989);var w=e.i(65658);function b(){let e=(0,r.useParams)(),b=(0,r.useRouter)(),v=e.id,j=(0,s.useRoleGuard)({allowedRoles:["admin","worker"]}),[_,N]=(0,a.useState)(null),[S,k]=(0,a.useState)([]),[A,C]=(0,a.useState)([]),[P,q]=(0,a.useState)(!0),[E,I]=(0,a.useState)(!1),[$,T]=(0,a.useState)(""),[D,B]=(0,a.useState)("unassigned"),[M,U]=(0,a.useState)("worker");function z(e,t){let a=String(e?.code||""),r=String(e?.message||""),s=r.toLowerCase();return"42501"===a||s.includes("permission denied")||s.includes("row level security")||s.includes("violates row-level security")?(alert("No tienes permisos para realizar esta acción."),!0):(alert(t+r),!1)}let V=(0,a.useCallback)(async()=>{q(!0);try{let e=Number(v);if(!e){N(null),k([]),q(!1);return}let t=await (0,w.fetchPedidoDetail)(e);N(t.pedido),T(String(t.pedido?.status||"")),B(String(t.pedido?.asignado_a||"unassigned")),k(t.items)}catch(e){console.error("Error fetching pedido:",e),N(null),k([])}q(!1)},[v]);async function R(e){try{await (0,w.assignPedidoToWorker)({pedidoId:Number(v),workerId:"unassigned"===e?null:e}),B(e),V()}catch(e){z(e,"Error al asignar: ")}}async function L(){I(!0),console.log("Updating status to:",$);try{await (0,w.updatePedidoStatusWithStock)({pedidoId:Number(v),nextStatus:$,stockDescontado:!!_?.stock_descontado}),alert("Estado actualizado correctamente"),V()}catch(e){console.error("Error updating status:",e),z(e,"Error al actualizar: ")}I(!1)}return((0,a.useEffect)(()=>{if(!v||j.loading||j.accessDenied)return;let e=String(j.role||"worker");U(e),(async()=>{if("admin"===e)try{let e=await (0,w.fetchAdminWorkers)();C(e)}catch(e){C([])}else C([]);await V()})()},[v,j.loading,j.accessDenied,j.role,V]),j.loading)?(0,t.jsx)("div",{className:"p-10",children:"Cargando..."}):j.accessDenied?(0,t.jsx)(i.AccessDenied,{}):P?(0,t.jsx)("div",{className:"p-10 text-center",children:"Cargando pedido..."}):_?(0,t.jsxs)("div",{className:"space-y-6 max-w-5xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:()=>b.back(),children:(0,t.jsx)(c.ArrowLeft,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-2",children:["Pedido #",_.id.toString().padStart(6,"0"),(0,t.jsx)(x,{status:_.status})]}),(0,t.jsxs)("p",{className:"text-gray-500 text-sm",children:["Realizado el ",new Date(_.created_at).toLocaleString()]})]}),(0,t.jsxs)("div",{className:"ml-auto flex gap-2 items-center",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>b.push(`/admin/pedidos/${v}/ticket`),children:"Descargar ticket"}),(0,t.jsxs)("div",{className:"flex gap-2 items-center bg-white p-2 rounded-lg border shadow-sm",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Estado:"}),(0,t.jsxs)(d.Select,{value:$,onValueChange:T,children:[(0,t.jsx)(d.SelectTrigger,{className:"w-[180px]",children:(0,t.jsx)(d.SelectValue,{})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"Pendiente",children:"Pendiente"}),(0,t.jsx)(d.SelectItem,{value:"Confirmado",children:"Confirmado"}),(0,t.jsx)(d.SelectItem,{value:"Preparando",children:"Preparando"}),(0,t.jsx)(d.SelectItem,{value:"Enviado",children:"Enviado"}),(0,t.jsx)(d.SelectItem,{value:"Entregado",children:"Entregado"}),(0,t.jsx)(d.SelectItem,{value:"Fallido",children:"Fallido / Cancelado"})]})]}),(0,t.jsxs)(n.Button,{size:"sm",onClick:L,disabled:E||$===_.status,children:[(0,t.jsx)(f.Save,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"md:col-span-2 space-y-6",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[(0,t.jsxs)("h2",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[(0,t.jsx)(y,{className:"h-5 w-5"})," Productos"]}),(0,t.jsx)("div",{className:"space-y-4",children:S.map(e=>(0,t.jsxs)("div",{className:"flex gap-4 items-center border-b pb-4 last:border-0 last:pb-0",children:[(0,t.jsx)("div",{className:"h-16 w-16 bg-gray-100 rounded-md overflow-hidden flex-shrink-0",children:e.productos?.imagen_url?(0,t.jsx)("img",{src:e.productos.imagen_url,className:"h-full w-full object-cover"}):(0,t.jsx)("div",{className:"h-full w-full flex items-center justify-center text-gray-400 text-xs",children:"Sin img"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.productos?.nombre||"Producto eliminado"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Cantidad: ",e.cantidad]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-medium",children:(0,g.formatCurrency)((e.productos?.precio||0)*(e.cantidad||0))}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[(0,g.formatCurrency)(e.productos?.precio||0)," c/u"]})]})]},e.id))}),(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t flex justify-between items-center text-lg font-bold",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsx)("span",{children:(0,g.formatCurrency)(_.total)})]})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,t.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,t.jsx)(m.User,{className:"h-5 w-5"})," Cliente"]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Nombre"}),(0,t.jsx)("p",{className:"font-medium",children:_.clientes?.nombre})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"DNI"}),(0,t.jsx)("p",{className:"font-medium",children:_.clientes?.dni||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Teléfono"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Phone,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)("a",{href:`tel:${_.clientes?.telefono}`,className:"font-medium text-blue-600 hover:underline",children:_.clientes?.telefono})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,t.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,t.jsx)(l.MapPin,{className:"h-5 w-5"})," Envío"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Dirección"}),(0,t.jsx)("p",{className:"font-medium text-sm mt-1",children:_.clientes?.direccion})]}),(0,t.jsx)(n.Button,{variant:"outline",className:"w-full text-xs",onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(_.clientes?.direccion)}`,"_blank"),children:"Ver en Google Maps"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,t.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,t.jsx)(p.CreditCard,{className:"h-5 w-5"})," Pago"]}),(0,t.jsx)(o.Badge,{variant:"secondary",className:"text-sm py-1 px-3 w-full justify-center",children:_.pago_status})]}),"admin"===M&&(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 space-y-4",children:[(0,t.jsxs)("h2",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[(0,t.jsx)(h,{className:"h-5 w-5"})," Asignación"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Trabajador asignado"}),(0,t.jsxs)(d.Select,{value:D,onValueChange:R,children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{children:_.asignado_perfil?.nombre||_.asignado_perfil?.email||(0,t.jsx)("span",{className:"text-orange-600",children:"Sin asignar"})})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"unassigned",children:(0,t.jsx)("span",{className:"text-gray-500",children:"Sin asignar"})}),A.map(e=>(0,t.jsx)(d.SelectItem,{value:e.id,children:e.nombre||e.email},e.id))]})]})]}),_.fecha_asignacion&&(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:["Asignado el ",new Date(_.fecha_asignacion).toLocaleString()]})]}),"worker"===M&&_.asignado_perfil&&(0,t.jsxs)("div",{className:"bg-blue-50 rounded-xl border border-blue-200 p-4",children:[(0,t.jsx)("p",{className:"text-xs text-blue-600 font-medium",children:"Este pedido te fue asignado"}),_.fecha_asignacion&&(0,t.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:new Date(_.fecha_asignacion).toLocaleString()})]})]})]})]}):(0,t.jsx)("div",{className:"p-10 text-center",children:"Pedido no encontrado"})}function x({status:e}){return(0,t.jsx)("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium border ${{Pendiente:"bg-yellow-100 text-yellow-800 border-yellow-200",Confirmado:"bg-blue-100 text-blue-800 border-blue-200",Entregado:"bg-green-100 text-green-800 border-green-200",Cancelado:"bg-red-100 text-red-800 border-red-200"}[e]||"bg-gray-100"}`,children:e})}function y({className:e}){return(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[(0,t.jsx)("path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"}),(0,t.jsx)("path",{d:"M3 6h18"}),(0,t.jsx)("path",{d:"M16 10a4 4 0 0 1-8 0"})]})}e.s(["default",()=>b],17153)}]);